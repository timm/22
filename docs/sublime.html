<!doctype html>
<html lang="en">
<head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1">
    <meta name="generator" content="pdoc 9.0.1" />
    <title>sublime API documentation</title>
    <link rel="icon" type="image/svg+xml" href="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20width%3D%2264%22%20height%3D%2264%22%20viewBox%3D%2244.5%202.5%2015%2015%22%3E%3Cpath%20d%3D%22M49.351%2021.041c-.233-.721-.546-2.408-.772-4.076-.042-.09-.067-.187-.046-.288-.166-1.347-.277-2.625-.241-3.351-1.378-1.008-2.271-2.586-2.271-4.362%200-.976.272-1.935.788-2.774.057-.094.122-.18.184-.268-.033-.167-.052-.339-.052-.516%200-1.477%201.202-2.679%202.679-2.679.791%200%201.496.352%201.987.9a6.3%206.3%200%200%201%201.001.029c.492-.564%201.207-.929%202.012-.929%201.477%200%202.679%201.202%202.679%202.679a2.65%202.65%200%200%201-.269%201.148c.383.747.595%201.572.595%202.41%200%202.311-1.507%204.29-3.635%205.107.037.699.147%202.27.423%203.294l.137.461c.156%202.136-4.612%205.166-5.199%203.215zm.127-4.919a4.78%204.78%200%200%200%20.775-.584c-.172-.115-.505-.254-.88-.378zm.331%202.302l.828-.502c-.202-.143-.576-.328-.984-.49zm.45%202.157l.701-.403c-.214-.115-.536-.249-.891-.376l.19.779zM49.13%204.141c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm.735-.389a1.15%201.15%200%200%201%20.314.783%201.16%201.16%200%200%201-1.162%201.162c-.457%200-.842-.27-1.032-.653-.026.117-.042.238-.042.362a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.843-.626-1.535-1.436-1.654zm3.076%201.654a1.68%201.68%200%200%200%201.679%201.679%201.68%201.68%200%200%200%201.679-1.679c0-.037-.009-.072-.011-.109-.21.3-.541.508-.935.508a1.16%201.16%200%200%201-1.162-1.162%201.14%201.14%200%200%201%20.474-.912c-.015%200-.03-.005-.045-.005-.926.001-1.679.754-1.679%201.68zm1.861-1.265c0%20.152.123.276.276.276s.275-.124.275-.276-.123-.276-.276-.276-.275.124-.275.276zm1.823%204.823c0-.52-.103-1.035-.288-1.52-.466.394-1.06.64-1.717.64-1.144%200-2.116-.725-2.499-1.738-.383%201.012-1.355%201.738-2.499%201.738-.867%200-1.631-.421-2.121-1.062-.307.605-.478%201.267-.478%201.942%200%202.486%202.153%204.51%204.801%204.51s4.801-2.023%204.801-4.51zm-3.032%209.156l-.146-.492c-.276-1.02-.395-2.457-.444-3.268a6.11%206.11%200%200%201-1.18.115%206.01%206.01%200%200%201-2.536-.562l.006.175c.802.215%201.848.612%202.021%201.25.079.295-.021.601-.274.837l-.598.501c.667.304%201.243.698%201.311%201.179.02.144.022.507-.393.787l-.564.365c1.285.521%201.361.96%201.381%201.126.018.142.011.496-.427.746l-.854.489c.064-1.19%201.985-2.585%202.697-3.248zM49.34%209.925c0-.667%201-.667%201%200%200%20.653.818%201.205%201.787%201.205s1.787-.552%201.787-1.205c0-.667%201-.667%201%200%200%201.216-1.25%202.205-2.787%202.205s-2.787-.989-2.787-2.205zm-.887-7.633c-.093.077-.205.114-.317.114a.5.5%200%200%201-.318-.886L49.183.397a.5.5%200%200%201%20.703.068.5.5%200%200%201-.069.703zm7.661-.065c-.086%200-.173-.022-.253-.068l-1.523-.893c-.575-.337-.069-1.2.506-.863l1.523.892a.5.5%200%200%201%20.179.685c-.094.158-.261.247-.432.247z%22%20fill%3D%22%233bb300%22/%3E%3C/svg%3E"/>

<script>
    window.MathJax = {
        tex: {
            inlineMath: [['$', '$'], ['\\(', '\\)']]
        }
    };
</script>
<script src="https://polyfill.io/v3/polyfill.min.js?features=es6"></script>
<script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
<script>
    /* Re-invoke MathJax when DOM content changes, for example during search. */
    document.addEventListener("DOMContentLoaded", () => {
        new MutationObserver(() => MathJax.typeset()).observe(
            document.querySelector("main.pdoc").parentNode,
            {childList: true}
        );
    })
</script>
<style>/*! * Bootstrap Reboot v5.0.0 (https://getbootstrap.com/) * Copyright 2011-2021 The Bootstrap Authors * Copyright 2011-2021 Twitter, Inc. * Licensed under MIT (https://github.com/twbs/bootstrap/blob/main/LICENSE) * Forked from Normalize.css, licensed MIT (https://github.com/necolas/normalize.css/blob/master/LICENSE.md) */*,::after,::before{box-sizing:border-box}@media (prefers-reduced-motion:no-preference){:root{scroll-behavior:smooth}}body{margin:0;font-family:system-ui,-apple-system,"Segoe UI",Roboto,"Helvetica Neue",Arial,"Noto Sans","Liberation Sans",sans-serif,"Apple Color Emoji","Segoe UI Emoji","Segoe UI Symbol","Noto Color Emoji";font-size:1rem;font-weight:400;line-height:1.5;color:#212529;background-color:#fff;-webkit-text-size-adjust:100%;-webkit-tap-highlight-color:transparent}hr{margin:1rem 0;color:inherit;background-color:currentColor;border:0;opacity:.25}hr:not([size]){height:1px}h1,h2,h3,h4,h5,h6{margin-top:0;margin-bottom:.5rem;font-weight:500;line-height:1.2}h1{font-size:calc(1.375rem + 1.5vw)}@media (min-width:1200px){h1{font-size:2.5rem}}h2{font-size:calc(1.325rem + .9vw)}@media (min-width:1200px){h2{font-size:2rem}}h3{font-size:calc(1.3rem + .6vw)}@media (min-width:1200px){h3{font-size:1.75rem}}h4{font-size:calc(1.275rem + .3vw)}@media (min-width:1200px){h4{font-size:1.5rem}}h5{font-size:1.25rem}h6{font-size:1rem}p{margin-top:0;margin-bottom:1rem}abbr[data-bs-original-title],abbr[title]{-webkit-text-decoration:underline dotted;text-decoration:underline dotted;cursor:help;-webkit-text-decoration-skip-ink:none;text-decoration-skip-ink:none}address{margin-bottom:1rem;font-style:normal;line-height:inherit}ol,ul{padding-left:2rem}dl,ol,ul{margin-top:0;margin-bottom:1rem}ol ol,ol ul,ul ol,ul ul{margin-bottom:0}dt{font-weight:700}dd{margin-bottom:.5rem;margin-left:0}blockquote{margin:0 0 1rem}b,strong{font-weight:bolder}small{font-size:.875em}mark{padding:.2em;background-color:#fcf8e3}sub,sup{position:relative;font-size:.75em;line-height:0;vertical-align:baseline}sub{bottom:-.25em}sup{top:-.5em}a{color:#0d6efd;text-decoration:underline}a:hover{color:#0a58ca}a:not([href]):not([class]),a:not([href]):not([class]):hover{color:inherit;text-decoration:none}code,kbd,pre,samp{font-family:SFMono-Regular,Menlo,Monaco,Consolas,"Liberation Mono","Courier New",monospace;font-size:1em;direction:ltr;unicode-bidi:bidi-override}pre{display:block;margin-top:0;margin-bottom:1rem;overflow:auto;font-size:.875em}pre code{font-size:inherit;color:inherit;word-break:normal}code{font-size:.875em;color:#d63384;word-wrap:break-word}a>code{color:inherit}kbd{padding:.2rem .4rem;font-size:.875em;color:#fff;background-color:#212529;border-radius:.2rem}kbd kbd{padding:0;font-size:1em;font-weight:700}figure{margin:0 0 1rem}img,svg{vertical-align:middle}table{caption-side:bottom;border-collapse:collapse}caption{padding-top:.5rem;padding-bottom:.5rem;color:#6c757d;text-align:left}th{text-align:inherit;text-align:-webkit-match-parent}tbody,td,tfoot,th,thead,tr{border-color:inherit;border-style:solid;border-width:0}label{display:inline-block}button{border-radius:0}button:focus:not(:focus-visible){outline:0}button,input,optgroup,select,textarea{margin:0;font-family:inherit;font-size:inherit;line-height:inherit}button,select{text-transform:none}[role=button]{cursor:pointer}select{word-wrap:normal}select:disabled{opacity:1}[list]::-webkit-calendar-picker-indicator{display:none}[type=button],[type=reset],[type=submit],button{-webkit-appearance:button}[type=button]:not(:disabled),[type=reset]:not(:disabled),[type=submit]:not(:disabled),button:not(:disabled){cursor:pointer}::-moz-focus-inner{padding:0;border-style:none}textarea{resize:vertical}fieldset{min-width:0;padding:0;margin:0;border:0}legend{float:left;width:100%;padding:0;margin-bottom:.5rem;font-size:calc(1.275rem + .3vw);line-height:inherit}@media (min-width:1200px){legend{font-size:1.5rem}}legend+*{clear:left}::-webkit-datetime-edit-day-field,::-webkit-datetime-edit-fields-wrapper,::-webkit-datetime-edit-hour-field,::-webkit-datetime-edit-minute,::-webkit-datetime-edit-month-field,::-webkit-datetime-edit-text,::-webkit-datetime-edit-year-field{padding:0}::-webkit-inner-spin-button{height:auto}[type=search]{outline-offset:-2px;-webkit-appearance:textfield}::-webkit-search-decoration{-webkit-appearance:none}::-webkit-color-swatch-wrapper{padding:0}::file-selector-button{font:inherit}::-webkit-file-upload-button{font:inherit;-webkit-appearance:button}output{display:inline-block}iframe{border:0}summary{display:list-item;cursor:pointer}progress{vertical-align:baseline}[hidden]{display:none!important}</style>
<style>/*! pygments syntax highlighting */pre{line-height:125%;}td.linenos pre{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}span.linenos{color:#000000; background-color:#f0f0f0; padding-left:5px; padding-right:5px;}td.linenos pre.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}span.linenos.special{color:#000000; background-color:#ffffc0; padding-left:5px; padding-right:5px;}.pdoc .hll{background-color:#ffffcc}.pdoc{background:#f8f8f8;}.pdoc .c{color:#408080; font-style:italic}.pdoc .err{border:1px solid #FF0000}.pdoc .k{color:#008000; font-weight:bold}.pdoc .o{color:#666666}.pdoc .ch{color:#408080; font-style:italic}.pdoc .cm{color:#408080; font-style:italic}.pdoc .cp{color:#BC7A00}.pdoc .cpf{color:#408080; font-style:italic}.pdoc .c1{color:#408080; font-style:italic}.pdoc .cs{color:#408080; font-style:italic}.pdoc .gd{color:#A00000}.pdoc .ge{font-style:italic}.pdoc .gr{color:#FF0000}.pdoc .gh{color:#000080; font-weight:bold}.pdoc .gi{color:#00A000}.pdoc .go{color:#888888}.pdoc .gp{color:#000080; font-weight:bold}.pdoc .gs{font-weight:bold}.pdoc .gu{color:#800080; font-weight:bold}.pdoc .gt{color:#0044DD}.pdoc .kc{color:#008000; font-weight:bold}.pdoc .kd{color:#008000; font-weight:bold}.pdoc .kn{color:#008000; font-weight:bold}.pdoc .kp{color:#008000}.pdoc .kr{color:#008000; font-weight:bold}.pdoc .kt{color:#B00040}.pdoc .m{color:#666666}.pdoc .s{color:#BA2121}.pdoc .na{color:#7D9029}.pdoc .nb{color:#008000}.pdoc .nc{color:#0000FF; font-weight:bold}.pdoc .no{color:#880000}.pdoc .nd{color:#AA22FF}.pdoc .ni{color:#999999; font-weight:bold}.pdoc .ne{color:#D2413A; font-weight:bold}.pdoc .nf{color:#0000FF}.pdoc .nl{color:#A0A000}.pdoc .nn{color:#0000FF; font-weight:bold}.pdoc .nt{color:#008000; font-weight:bold}.pdoc .nv{color:#19177C}.pdoc .ow{color:#AA22FF; font-weight:bold}.pdoc .w{color:#bbbbbb}.pdoc .mb{color:#666666}.pdoc .mf{color:#666666}.pdoc .mh{color:#666666}.pdoc .mi{color:#666666}.pdoc .mo{color:#666666}.pdoc .sa{color:#BA2121}.pdoc .sb{color:#BA2121}.pdoc .sc{color:#BA2121}.pdoc .dl{color:#BA2121}.pdoc .sd{color:#BA2121; font-style:italic}.pdoc .s2{color:#BA2121}.pdoc .se{color:#BB6622; font-weight:bold}.pdoc .sh{color:#BA2121}.pdoc .si{color:#BB6688; font-weight:bold}.pdoc .sx{color:#008000}.pdoc .sr{color:#BB6688}.pdoc .s1{color:#BA2121}.pdoc .ss{color:#19177C}.pdoc .bp{color:#008000}.pdoc .fm{color:#0000FF}.pdoc .vc{color:#19177C}.pdoc .vg{color:#19177C}.pdoc .vi{color:#19177C}.pdoc .vm{color:#19177C}.pdoc .il{color:#666666}</style>
<style>/*! pdoc */:root{--pdoc-background:#fff;}.pdoc{--text:#212529;--muted:#6c757d;--link:#3660a5;--link-hover:#1659c5;--code:#f7f7f7;--active:#fff598;--accent:#eee;--accent2:#c1c1c1;--nav-hover:rgba(255, 255, 255, 0.5);--name:#0066BB;--def:#008800;--annotation:#007020;}body{background-color:var(--pdoc-background);}html, body{width:100%;height:100%;}@media (max-width:769px){#navtoggle{cursor:pointer;position:absolute;width:50px;height:40px;top:1rem;right:1rem;border-color:var(--text);color:var(--text);display:flex;opacity:0.8;}#navtoggle:hover{opacity:1;}#togglestate + div{display:none;}#togglestate:checked + div{display:inherit;}main, header{padding:2rem 3vw;}.git-button{display:none !important;}nav input[type="search"]{max-width:77%;}nav input[type="search"]:first-child{margin-top:-6px;}nav input[type="search"]:valid ~ *{display:none !important;}}@media (min-width:770px){:root{--sidebar-width:clamp(12.5rem, 28vw, 22rem);}nav{position:fixed;overflow:auto;height:100vh;width:var(--sidebar-width);}main, header{padding:3rem 2rem 3rem calc(var(--sidebar-width) + 3rem);width:calc(54rem + var(--sidebar-width));max-width:100%;}#navtoggle{display:none;}}#togglestate{position:absolute;height:0;}nav.pdoc{--pad:1.75rem;--indent:1.5rem;background-color:var(--accent);border-right:1px solid var(--accent2);box-shadow:0 0 20px rgba(50, 50, 50, .2) inset;padding:0 0 0 var(--pad);overflow-wrap:anywhere;scrollbar-width:thin; scrollbar-color:var(--accent2) transparent }nav.pdoc::-webkit-scrollbar{width:.4rem; }nav.pdoc::-webkit-scrollbar-thumb{background-color:var(--accent2); }nav.pdoc > div{padding:var(--pad) 0;}nav.pdoc .module-list-button{display:inline-flex;align-items:center;color:var(--text);border-color:var(--muted);margin-bottom:1rem;}nav.pdoc .module-list-button:hover{border-color:var(--text);}nav.pdoc input[type=search]{display:block;outline-offset:0;width:calc(100% - var(--pad));}nav.pdoc .logo{max-width:calc(100% - var(--pad));max-height:35vh;display:block;margin:0 auto 1rem;transform:translate(calc(-.5 * var(--pad)), 0);}nav.pdoc ul{list-style:none;padding-left:0;}nav.pdoc li{display:block;margin:0;padding:.2rem 0 .2rem var(--indent);transition:all 100ms;}nav.pdoc > div > ul > li{padding-left:0;}nav.pdoc li:hover{background-color:var(--nav-hover);}nav.pdoc a, nav.pdoc a:hover{color:var(--text);}nav.pdoc a{display:block;}nav.pdoc > h2:first-of-type{margin-top:1.5rem;}nav.pdoc .class:before{content:"class ";color:var(--muted);}nav.pdoc .function:after{content:"()";color:var(--muted);}nav.pdoc footer:before{content:"";display:block;width:calc(100% - var(--pad));border-top:solid var(--accent2) 1px;margin-top:1.5rem;padding-top:.5rem;}nav.pdoc footer{font-size:small;}html, main{scroll-behavior:smooth;}.pdoc{color:var(--text);box-sizing:border-box;line-height:1.5;background:none;}.pdoc .pdoc-button{display:inline-block;border:solid black 1px;border-radius:2px;font-size:.75rem;padding:calc(0.5em - 1px) 1em;transition:100ms all;}.pdoc .visually-hidden{position:absolute !important;width:1px !important;height:1px !important;padding:0 !important;margin:-1px !important;overflow:hidden !important;clip:rect(0, 0, 0, 0) !important;white-space:nowrap !important;border:0 !important;}.pdoc h1, .pdoc h2, .pdoc h3{font-weight:300;margin:.3em 0;padding:.2em 0;}.pdoc a{text-decoration:none;color:var(--link);}.pdoc a:hover{color:var(--link-hover);}.pdoc blockquote{margin-left:2rem;}.pdoc pre{background-color:var(--code);border-top:1px solid var(--accent2);border-bottom:1px solid var(--accent2);margin-bottom:1em;padding:.5rem 0 .5rem .5rem;overflow-x:auto;}.pdoc code{color:var(--text);padding:.2em .4em;margin:0;font-size:85%;background-color:var(--code);border-radius:6px;}.pdoc a > code{color:inherit;}.pdoc pre > code{display:inline-block;font-size:inherit;background:none;border:none;padding:0;}.pdoc .modulename{margin-top:0;font-weight:bold;}.pdoc .modulename a{color:var(--link);transition:100ms all;}.pdoc .git-button{float:right;border:solid var(--link) 1px;}.pdoc .git-button:hover{background-color:var(--link);color:var(--pdoc-background);}.pdoc details{filter:opacity(1);}.pdoc details:not([open]){height:0;}.pdoc details > summary{position:absolute;top:-35px;right:0;font-size:.75rem;color:var(--muted);padding:0 .7em;user-select:none;}.pdoc details > summary:focus{outline:0;}.pdoc .docstring{margin-bottom:1.5rem;}.pdoc > section:first-of-type > .docstring{margin-bottom:2.5rem;}.pdoc .docstring pre{margin-left:1em;margin-right:1em;}.pdoc h1:target,.pdoc h2:target,.pdoc h3:target,.pdoc h4:target,.pdoc h5:target,.pdoc h6:target{background-color:var(--active);box-shadow:-1rem 0 0 0 var(--active);}.pdoc div:target > .attr,.pdoc section:target > .attr,.pdoc dd:target > a{background-color:var(--active);}.pdoc .attr:hover{filter:contrast(0.95);}.pdoc .headerlink{position:absolute;width:0;margin-left:-1.5rem;line-height:1.4rem;font-size:1.5rem;font-weight:normal;transition:all 100ms ease-in-out;opacity:0;user-select:none;}.pdoc .attr > .headerlink{margin-left:-2.5rem;}.pdoc *:hover > .headerlink,.pdoc *:target > .attr > .headerlink{opacity:1;}.pdoc .attr{display:block;color:var(--text);margin:.5rem 0 .5rem;padding:.4rem 5rem .4rem 1rem;background-color:var(--accent);}.pdoc .classattr{margin-left:2rem;}.pdoc .name{color:var(--name);font-weight:bold;}.pdoc .def{color:var(--def);font-weight:bold;}.pdoc .signature{white-space:pre-wrap;}.pdoc .annotation{color:var(--annotation);}.pdoc .inherited{margin-left:2rem;}.pdoc .inherited dt{font-weight:700;}.pdoc .inherited dt, .pdoc .inherited dd{display:inline;margin-left:0;margin-bottom:.5rem;}.pdoc .inherited dd:not(:last-child):after{content:", ";}.pdoc .inherited .class:before{content:"class ";}.pdoc .inherited .function a:after{content:"()";}.pdoc .search-result .docstring{overflow:auto;max-height:25vh;}.pdoc .search-result.focused > .attr{background-color:var(--active);}.pdoc .attribution{margin-top:2rem;display:block;opacity:0.5;transition:all 200ms;filter:grayscale(100%);}.pdoc .attribution:hover{opacity:1;filter:grayscale(0%);}.pdoc .attribution img{margin-left:5px;height:35px;vertical-align:middle;width:70px;transition:all 200ms;}.pdoc table{display:block;width:max-content;max-width:100%;overflow:auto;margin-bottom:1rem;}.pdoc table th{font-weight:600;}.pdoc table th, .pdoc table td{padding:6px 13px;border:1px solid var(--accent2);}</style>
</head>
<body>        <nav class="pdoc">
            <label id="navtoggle" for="togglestate" class="pdoc-button"><svg xmlns='http://www.w3.org/2000/svg' viewBox='0 0 30 30'><path stroke-linecap='round' stroke="currentColor" stroke-miterlimit='10' stroke-width='2' d='M4 7h22M4 15h22M4 23h22'/></svg></label>
            <input id="togglestate" type="checkbox" aria-hidden="true" tabindex="-1">
            <div>

<a href="http://github.com/timm/sublime">                        <img src="https://raw.githubusercontent.com/timm/sublime/main/etc/img/lime.png" class="logo" alt="project logo"/>
</a>

                    <h2>Contents</h2>
                    <ul>
  <li><a href="#see-also">See Also</a></li>
  <li><a href="#algorithm">Algorithm</a></li>
  <li><a href="#license">License</a></li>
</ul>



                    <h2>API Documentation</h2>
                        <ul class="memberlist">
            <li>
                    <a class="function" href="#any">any</a>
            </li>
            <li>
                    <a class="function" href="#anywhere">anywhere</a>
            </li>
            <li>
                    <a class="function" href="#atom">atom</a>
            </li>
            <li>
                    <a class="function" href="#demo">demo</a>
            </li>
            <li>
                    <a class="function" href="#file">file</a>
            </li>
            <li>
                    <a class="function" href="#first">first</a>
            </li>
            <li>
                    <a class="function" href="#merge">merge</a>
            </li>
            <li>
                    <a class="class" href="#o">o</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#o.__init__">o</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="function" href="#options">options</a>
            </li>
            <li>
                    <a class="function" href="#r">r</a>
            </li>
            <li>
                    <a class="function" href="#rn">rn</a>
            </li>
            <li>
                    <a class="function" href="#rN">rN</a>
            </li>
            <li>
                    <a class="function" href="#second">second</a>
            </li>
            <li>
                    <a class="class" href="#Span">Span</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Span.__init__">Span</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.merge">merge</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.selects">selects</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.show">show</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.support">support</a>
                        </li>
                        <li>
                                <a class="function" href="#Span.sort">sort</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Col">Col</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Col.__init__">Col</a>
                        </li>
                        <li>
                                <a class="function" href="#Col.dist">dist</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Sym">Sym</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Sym.__init__">Sym</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.dist">dist</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.div">div</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.merge">merge</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.mid">mid</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.prep">prep</a>
                        </li>
                        <li>
                                <a class="function" href="#Sym.spans">spans</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Num">Num</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Num.__init__">Num</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.all">all</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.dist1">dist1</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.div">div</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.merge">merge</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.mid">mid</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.norm">norm</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.per">per</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.prep">prep</a>
                        </li>
                        <li>
                                <a class="function" href="#Num.spans">spans</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Explain">Explain</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Explain.__init__">Explain</a>
                        </li>
                        <li>
                                <a class="function" href="#Explain.show">show</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Cluster">Cluster</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Cluster.__init__">Cluster</a>
                        </li>
                        <li>
                                <a class="function" href="#Cluster.show">show</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Sample">Sample</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Sample.__init__">Sample</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.add">add</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.clone">clone</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.cluster">cluster</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.dist">dist</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.div">div</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.far">far</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.half">half</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.mid">mid</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.proj">proj</a>
                        </li>
                        <li>
                                <a class="function" href="#Sample.xplain">xplain</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="class" href="#Demos">Demos</a>
                            <ul class="memberlist">
                        <li>
                                <a class="function" href="#Demos.__init__">Demos</a>
                        </li>
                        <li>
                                <a class="variable" href="#Demos.fails">fails</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.opt">opt</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.seed">seed</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.num">num</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.sym">sym</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.rows">rows</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.sample">sample</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.dist">dist</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.far">far</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.clone">clone</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.half">half</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.cluster">cluster</a>
                        </li>
                        <li>
                                <a class="function" href="#Demos.xplain">xplain</a>
                        </li>
                </ul>

            </li>
            <li>
                    <a class="variable" href="#the">the</a>
            </li>
    </ul>


                    <footer>Share and enjoy</footer>

                    <a class="attribution" title="pdoc: Python API documentation generator" href="https://pdoc.dev">
                        built with <span class="visually-hidden">pdoc</span><img
                            alt="pdoc logo"
                            src="data:image/svg+xml,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20role%3D%22img%22%20aria-label%3D%22pdoc%20logo%22%20width%3D%22300%22%20height%3D%22150%22%20viewBox%3D%22-1%200%2060%2030%22%3E%3Ctitle%3Epdoc%3C/title%3E%3Cpath%20d%3D%22M29.621%2021.293c-.011-.273-.214-.475-.511-.481a.5.5%200%200%200-.489.503l-.044%201.393c-.097.551-.695%201.215-1.566%201.704-.577.428-1.306.486-2.193.182-1.426-.617-2.467-1.654-3.304-2.487l-.173-.172a3.43%203.43%200%200%200-.365-.306.49.49%200%200%200-.286-.196c-1.718-1.06-4.931-1.47-7.353.191l-.219.15c-1.707%201.187-3.413%202.131-4.328%201.03-.02-.027-.49-.685-.141-1.763.233-.721.546-2.408.772-4.076.042-.09.067-.187.046-.288.166-1.347.277-2.625.241-3.351%201.378-1.008%202.271-2.586%202.271-4.362%200-.976-.272-1.935-.788-2.774-.057-.094-.122-.18-.184-.268.033-.167.052-.339.052-.516%200-1.477-1.202-2.679-2.679-2.679-.791%200-1.496.352-1.987.9a6.3%206.3%200%200%200-1.001.029c-.492-.564-1.207-.929-2.012-.929-1.477%200-2.679%201.202-2.679%202.679A2.65%202.65%200%200%200%20.97%206.554c-.383.747-.595%201.572-.595%202.41%200%202.311%201.507%204.29%203.635%205.107-.037.699-.147%202.27-.423%203.294l-.137.461c-.622%202.042-2.515%208.257%201.727%2010.643%201.614.908%203.06%201.248%204.317%201.248%202.665%200%204.492-1.524%205.322-2.401%201.476-1.559%202.886-1.854%206.491.82%201.877%201.393%203.514%201.753%204.861%201.068%202.223-1.713%202.811-3.867%203.399-6.374.077-.846.056-1.469.054-1.537zm-4.835%204.313c-.054.305-.156.586-.242.629-.034-.007-.131-.022-.307-.157-.145-.111-.314-.478-.456-.908.221.121.432.25.675.355.115.039.219.051.33.081zm-2.251-1.238c-.05.33-.158.648-.252.694-.022.001-.125-.018-.307-.157-.217-.166-.488-.906-.639-1.573.358.344.754.693%201.198%201.036zm-3.887-2.337c-.006-.116-.018-.231-.041-.342.635.145%201.189.368%201.599.625.097.231.166.481.174.642-.03.049-.055.101-.067.158-.046.013-.128.026-.298.004-.278-.037-.901-.57-1.367-1.087zm-1.127-.497c.116.306.176.625.12.71-.019.014-.117.045-.345.016-.206-.027-.604-.332-.986-.695.41-.051.816-.056%201.211-.031zm-4.535%201.535c.209.22.379.47.358.598-.006.041-.088.138-.351.234-.144.055-.539-.063-.979-.259a11.66%2011.66%200%200%200%20.972-.573zm.983-.664c.359-.237.738-.418%201.126-.554.25.237.479.548.457.694-.006.042-.087.138-.351.235-.174.064-.694-.105-1.232-.375zm-3.381%201.794c-.022.145-.061.29-.149.401-.133.166-.358.248-.69.251h-.002c-.133%200-.306-.26-.45-.621.417.091.854.07%201.291-.031zm-2.066-8.077a4.78%204.78%200%200%201-.775-.584c.172-.115.505-.254.88-.378l-.105.962zm-.331%202.302a10.32%2010.32%200%200%201-.828-.502c.202-.143.576-.328.984-.49l-.156.992zm-.45%202.157l-.701-.403c.214-.115.536-.249.891-.376a11.57%2011.57%200%200%201-.19.779zm-.181%201.716c.064.398.194.702.298.893-.194-.051-.435-.162-.736-.398.061-.119.224-.3.438-.495zM8.87%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zm-.735-.389a1.15%201.15%200%200%200-.314.783%201.16%201.16%200%200%200%201.162%201.162c.457%200%20.842-.27%201.032-.653.026.117.042.238.042.362a1.68%201.68%200%200%201-1.679%201.679%201.68%201.68%200%200%201-1.679-1.679c0-.843.626-1.535%201.436-1.654zM5.059%205.406A1.68%201.68%200%200%201%203.38%207.085a1.68%201.68%200%200%201-1.679-1.679c0-.037.009-.072.011-.109.21.3.541.508.935.508a1.16%201.16%200%200%200%201.162-1.162%201.14%201.14%200%200%200-.474-.912c.015%200%20.03-.005.045-.005.926.001%201.679.754%201.679%201.68zM3.198%204.141c0%20.152-.123.276-.276.276s-.275-.124-.275-.276.123-.276.276-.276.275.124.275.276zM1.375%208.964c0-.52.103-1.035.288-1.52.466.394%201.06.64%201.717.64%201.144%200%202.116-.725%202.499-1.738.383%201.012%201.355%201.738%202.499%201.738.867%200%201.631-.421%202.121-1.062.307.605.478%201.267.478%201.942%200%202.486-2.153%204.51-4.801%204.51s-4.801-2.023-4.801-4.51zm24.342%2019.349c-.985.498-2.267.168-3.813-.979-3.073-2.281-5.453-3.199-7.813-.705-1.315%201.391-4.163%203.365-8.423.97-3.174-1.786-2.239-6.266-1.261-9.479l.146-.492c.276-1.02.395-2.457.444-3.268a6.11%206.11%200%200%200%201.18.115%206.01%206.01%200%200%200%202.536-.562l-.006.175c-.802.215-1.848.612-2.021%201.25-.079.295.021.601.274.837.219.203.415.364.598.501-.667.304-1.243.698-1.311%201.179-.02.144-.022.507.393.787.213.144.395.26.564.365-1.285.521-1.361.96-1.381%201.126-.018.142-.011.496.427.746l.854.489c-.473.389-.971.914-.999%201.429-.018.278.095.532.316.713.675.556%201.231.721%201.653.721.059%200%20.104-.014.158-.02.207.707.641%201.64%201.513%201.64h.013c.8-.008%201.236-.345%201.462-.626.173-.216.268-.457.325-.692.424.195.93.374%201.372.374.151%200%20.294-.021.423-.068.732-.27.944-.704.993-1.021.009-.061.003-.119.002-.179.266.086.538.147.789.147.15%200%20.294-.021.423-.069.542-.2.797-.489.914-.754.237.147.478.258.704.288.106.014.205.021.296.021.356%200%20.595-.101.767-.229.438.435%201.094.992%201.656%201.067.106.014.205.021.296.021a1.56%201.56%200%200%200%20.323-.035c.17.575.453%201.289.866%201.605.358.273.665.362.914.362a.99.99%200%200%200%20.421-.093%201.03%201.03%200%200%200%20.245-.164c.168.428.39.846.68%201.068.358.273.665.362.913.362a.99.99%200%200%200%20.421-.093c.317-.148.512-.448.639-.762.251.157.495.257.726.257.127%200%20.25-.024.37-.071.427-.17.706-.617.841-1.314.022-.015.047-.022.068-.038.067-.051.133-.104.196-.159-.443%201.486-1.107%202.761-2.086%203.257zM8.66%209.925a.5.5%200%201%200-1%200c0%20.653-.818%201.205-1.787%201.205s-1.787-.552-1.787-1.205a.5.5%200%201%200-1%200c0%201.216%201.25%202.205%202.787%202.205s2.787-.989%202.787-2.205zm4.4%2015.965l-.208.097c-2.661%201.258-4.708%201.436-6.086.527-1.542-1.017-1.88-3.19-1.844-4.198a.4.4%200%200%200-.385-.414c-.242-.029-.406.164-.414.385-.046%201.249.367%203.686%202.202%204.896.708.467%201.547.7%202.51.7%201.248%200%202.706-.392%204.362-1.174l.185-.086a.4.4%200%200%200%20.205-.527c-.089-.204-.326-.291-.527-.206zM9.547%202.292c.093.077.205.114.317.114a.5.5%200%200%200%20.318-.886L8.817.397a.5.5%200%200%200-.703.068.5.5%200%200%200%20.069.703l1.364%201.124zm-7.661-.065c.086%200%20.173-.022.253-.068l1.523-.893a.5.5%200%200%200-.506-.863l-1.523.892a.5.5%200%200%200-.179.685c.094.158.261.247.432.247z%22%20transform%3D%22matrix%28-1%200%200%201%2058%200%29%22%20fill%3D%22%233bb300%22/%3E%3Cpath%20d%3D%22M.3%2021.86V10.18q0-.46.02-.68.04-.22.18-.5.28-.54%201.34-.54%201.06%200%201.42.28.38.26.44.78.76-1.04%202.38-1.04%201.64%200%203.1%201.54%201.46%201.54%201.46%203.58%200%202.04-1.46%203.58-1.44%201.54-3.08%201.54-1.64%200-2.38-.92v4.04q0%20.46-.04.68-.02.22-.18.5-.14.3-.5.42-.36.12-.98.12-.62%200-1-.12-.36-.12-.52-.4-.14-.28-.18-.5-.02-.22-.02-.68zm3.96-9.42q-.46.54-.46%201.18%200%20.64.46%201.18.48.52%201.2.52.74%200%201.24-.52.52-.52.52-1.18%200-.66-.48-1.18-.48-.54-1.26-.54-.76%200-1.22.54zm14.741-8.36q.16-.3.54-.42.38-.12%201-.12.64%200%201.02.12.38.12.52.42.16.3.18.54.04.22.04.68v11.94q0%20.46-.04.7-.02.22-.18.5-.3.54-1.7.54-1.38%200-1.54-.98-.84.96-2.34.96-1.8%200-3.28-1.56-1.48-1.58-1.48-3.66%200-2.1%201.48-3.68%201.5-1.58%203.28-1.58%201.48%200%202.3%201v-4.2q0-.46.02-.68.04-.24.18-.52zm-3.24%2010.86q.52.54%201.26.54.74%200%201.22-.54.5-.54.5-1.18%200-.66-.48-1.22-.46-.56-1.26-.56-.8%200-1.28.56-.48.54-.48%201.2%200%20.66.52%201.2zm7.833-1.2q0-2.4%201.68-3.96%201.68-1.56%203.84-1.56%202.16%200%203.82%201.56%201.66%201.54%201.66%203.94%200%201.66-.86%202.96-.86%201.28-2.1%201.9-1.22.6-2.54.6-1.32%200-2.56-.64-1.24-.66-2.1-1.92-.84-1.28-.84-2.88zm4.18%201.44q.64.48%201.3.48.66%200%201.32-.5.66-.5.66-1.48%200-.98-.62-1.46-.62-.48-1.34-.48-.72%200-1.34.5-.62.5-.62%201.48%200%20.96.64%201.46zm11.412-1.44q0%20.84.56%201.32.56.46%201.18.46.64%200%201.18-.36.56-.38.9-.38.6%200%201.46%201.06.46.58.46%201.04%200%20.76-1.1%201.42-1.14.8-2.8.8-1.86%200-3.58-1.34-.82-.64-1.34-1.7-.52-1.08-.52-2.36%200-1.3.52-2.34.52-1.06%201.34-1.7%201.66-1.32%203.54-1.32.76%200%201.48.22.72.2%201.06.4l.32.2q.36.24.56.38.52.4.52.92%200%20.5-.42%201.14-.72%201.1-1.38%201.1-.38%200-1.08-.44-.36-.34-1.04-.34-.66%200-1.24.48-.58.48-.58%201.34z%22%20fill%3D%22green%22/%3E%3C/svg%3E"/>
                    </a>
            </div>
        </nav>
    <main class="pdoc">
            <section>
                    <h1 class="modulename">
sublime    </h1>

                        <div class="docstring"><p>./<a href="#py">sublime.py</a> [OPTIONS] <br />
(c)2022 Tim Menzies <a href="&#109;&#x61;&#x69;&#x6c;&#116;o&#58;&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#x65;&#x65;&#x2e;&#111;&#114;&#x67;">&#116;&#105;&#109;&#109;&#64;&#105;&#101;&#x65;&#x65;&#x2e;&#111;&#114;&#x67;</a>, BSD license <br />
S.U.B.L.I.M.E. = <br />
Sublime's unsupervised bifurcation: let's infer minimal explanations. </p>

<p>OPTIONS:    </p>

<pre><code>-Max       max numbers to keep           : 512  
-Some      find `far` in this many egs   : 512  
-cautious  On any crash, stop+show stack : False    
-data      data file                     : data/auto93.csv   
-enough    min leaf size                 : .5
-help      show help                     : False  
-far       how far to look in `Some`     : .9  
-p         distance coefficient          : 2  
-seed      random number seed            : 10019  
-todo      start up task                 : nothing  
-xsmall    Cohen's small effect          : .35
</code></pre>

<h2 id="see-also">See Also</h2>

<p><a href="https://github.com/timm/sublime/issues">issues</a>
:: <a href="https://github.com/timm/sublime">repo</a>
:: <a href="https://github.com/timm/sublime/blob/main/docs/pdf">view source</a></p>

<p><a href=https://github.com/timm/sublime/actions/workflows/main.yml><img
src=https://github.com/timm/sublime/actions/workflows/main.yml/badge.svg></a>
<img src="https://img.shields.io/badge/purpose-se--ai-blueviolet" alt="" />
<img src="https://img.shields.io/badge/language-python3-orange" alt="" />
<img src="https://img.shields.io/badge/platform-osx,linux-pink" alt="" />
<a href="https://doi.org/10.5281/zenodo.5912461"><img src="https://zenodo.org/badge/DOI/10.5281/zenodo.5912461.svg" alt="DOI" /></a></p>

<h2 id="algorithm">Algorithm</h2>

<p>Stochastic clustering to generate tiny models.  Uses random projections
to divide the space. Then, optionally, explain the clusters by
unsupervised iterative dichotomization using ranges that most
distinguish sibling clusters.</p>

<h3 id="example1-just-bi-cluster-on-two-distant-points">Example1: just bi-cluster on two distant points</h3>

<pre><code>/<a href="#py">sublime.py</a> -c -s $RANDOM -t cluster
                                         :   398
|..                                      :   199
|.. |..                                  :    99
|.. |.. |..                              :    49    Lbs-   Acc+  Mpg+
|.. |.. |.. |..                          :    24  : [2255, 15.5, 30]
|.. |.. |.. |..                          :    25  : [2575, 16.4, 30]
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [2110, 16.4, 30] &lt;== best
|.. |.. |.. |..                          :    25  : [2205, 16, 30]
|.. |..                                  :   100
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [2234, 15.5, 30]
|.. |.. |.. |..                          :    25  : [2278, 16.5, 30] 
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [2220, 15.5, 30]
|.. |.. |.. |..                          :    25  : [2320, 15.8, 30]
|..                                      :   199
|.. |..                                  :    99
|.. |.. |..                              :    49
|.. |.. |.. |..                          :    24  : [2451, 16.5, 20]
|.. |.. |.. |..                          :    25  : [3021, 15.5, 20]
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [3425, 17.6, 20]
|.. |.. |.. |..                          :    25  : [3155, 16.7, 20]
|.. |..                                  :   100
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [4141, 13.5, 10]
|.. |.. |.. |..                          :    25  : [4054, 13.2, 20]
|.. |.. |..                              :    50
|.. |.. |.. |..                          :    25  : [4425, 11, 10]
|.. |.. |.. |..                          :    25  : [4129, 13, 10]
</code></pre>

<h3 id="example2-as-above-but-split-on-range-that-most-divides-data">Example2: as above but split on range that most divides data</h3>

<pre><code>./<a href="#py">sublime.py</a> -c -s $RANDOM -t xplain
                                                    Lbs-  Acc+  Mgg+
                                         :   398 : [2807, 15.5, 20]
198 &lt;= Lbs &lt; 454                         :   167 : [3725, 14.5, 20]
|.. Modl &lt; 72                            :    34 : [3609, 13,   20]
|.. Modl &gt;= 72                           :   133 : [3735, 14.9, 20]
|.. |.. Cylr &lt; 8                         :    56 : [3336, 17,   20]
|.. |.. |.. 77 &lt;= Modl &lt; 82              :    22 : [3410, 17.1, 20]
|.. |.. |.. Modl &lt; 77 or Modl &gt;= 82      :    34 : [3233, 17,   20]
|.. |.. Cylr &gt;= 8                        :    77 : [4129, 13.2, 20]
|.. |.. |.. Modl &lt; 75                    :    37 : [4274, 13,   10]
|.. |.. |.. Modl &gt;= 75                   :    40 : [3962, 13.5, 20]
|.. |.. |.. |.. Lbs &gt;= 302               :    35 : [4054, 13.2, 20]
Lbs &lt; 198 or Lbs &gt;= 454                  :   231 : [2290, 16,   30] &lt;== best
</code></pre>

<p></p>

<h2 id="license">License</h2>

<p>Redistribution and use in source and binary forms, with or without
modification, are permitted provided that the following conditions are met:</p>

<ol>
<li>Redistributions of source code must retain the above copyright notice, this
list of conditions and the following disclaimer.</li>
<li>Redistributions in binary form must reproduce the above copyright notice,
this list of conditions and the following disclaimer in the documentation
and/or other materials provided with the distribution.</li>
</ol>

<p>THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS "AS IS" AND
ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE
IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR
PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR
CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,
EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,
PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR
PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF
LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING
NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS
SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</p>
</div>

                        <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="ch">#!/usr/bin/env python3</span>
<span class="c1"># vim: ts=2 sw=2 sts=2 et :</span>
<span class="c1">#                                 _.</span>
<span class="c1">#                         _.-----&#39;&#39; `\</span>
<span class="c1">#             __..-----&#39;&#39;&#39;            `.</span>
<span class="c1">#            &lt;            `\.           &#39;\</span>
<span class="c1">#            :.              `.           `\</span>
<span class="c1">#             `:.            I  `.           `-.</span>
<span class="c1">#               `:\ P  a      O  `.            `+.</span>
<span class="c1">#                `:. L  i  a    ns`.   __.===::::;)</span>
<span class="c1">#           I  L E   `: n   t   ___.__&gt;&#39;::::::a:f/&#39;</span>
<span class="c1">#      i          X   `.  _,===:::=-&#39;-=-&quot;&quot;&quot;&#39;&#39;</span>
<span class="c1">#  m      n  a         &#39;-/:::&#39;&#39;</span>
<span class="c1">#                        &#39;&#39;</span>
<span class="c1">#           m</span>
<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">./sublime.py [OPTIONS]  </span>
<span class="sd">(c)2022 Tim Menzies &lt;timm@ieee.org&gt;, BSD license     </span>
<span class="sd">S.U.B.L.I.M.E. =    </span>
<span class="sd">Sublime&#39;s unsupervised bifurcation: let&#39;s infer minimal explanations. </span>

<span class="sd">OPTIONS:    </span>

<span class="sd">    -Max       max numbers to keep           : 512  </span>
<span class="sd">    -Some      find `far` in this many egs   : 512  </span>
<span class="sd">    -cautious  On any crash, stop+show stack : False    </span>
<span class="sd">    -data      data file                     : data/auto93.csv   </span>
<span class="sd">    -enough    min leaf size                 : .5</span>
<span class="sd">    -help      show help                     : False  </span>
<span class="sd">    -far       how far to look in `Some`     : .9  </span>
<span class="sd">    -p         distance coefficient          : 2  </span>
<span class="sd">    -seed      random number seed            : 10019  </span>
<span class="sd">    -todo      start up task                 : nothing  </span>
<span class="sd">    -xsmall    Cohen&#39;s small effect          : .35  </span>

<span class="sd">## See Also</span>

<span class="sd">[issues](https://github.com/timm/sublime/issues)</span>
<span class="sd">:: [repo](https://github.com/timm/sublime)</span>
<span class="sd">:: [view source](https://github.com/timm/sublime/blob/main/docs/pdf)</span>

<span class="sd">&lt;a href=https://github.com/timm/sublime/actions/workflows/main.yml&gt;&lt;img</span>
<span class="sd">src=https://github.com/timm/sublime/actions/workflows/main.yml/badge.svg&gt;&lt;/a&gt;</span>
<span class="sd">![](https://img.shields.io/badge/purpose-se--ai-blueviolet)</span>
<span class="sd">![](https://img.shields.io/badge/language-python3-orange)</span>
<span class="sd">![](https://img.shields.io/badge/platform-osx,linux-pink)</span>
<span class="sd">[![DOI](https://zenodo.org/badge/DOI/10.5281/zenodo.5912461.svg)](https://doi.org/10.5281/zenodo.5912461)</span>
<span class="sd">## Algorithm</span>

<span class="sd">Stochastic clustering to generate tiny models.  Uses random projections</span>
<span class="sd">to divide the space. Then, optionally, explain the clusters by</span>
<span class="sd">unsupervised iterative dichotomization using ranges that most</span>
<span class="sd">distinguish sibling clusters.</span>

<span class="sd">### Example1: just bi-cluster on two distant points</span>

<span class="sd">```</span>
<span class="sd">/sublime.py -c -s $RANDOM -t cluster</span>
<span class="sd">                                         :   398</span>
<span class="sd">|..                                      :   199</span>
<span class="sd">|.. |..                                  :    99</span>
<span class="sd">|.. |.. |..                              :    49    Lbs-   Acc+  Mpg+</span>
<span class="sd">|.. |.. |.. |..                          :    24  : [2255, 15.5, 30]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2575, 16.4, 30]</span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2110, 16.4, 30] &lt;== best</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2205, 16, 30]</span>
<span class="sd">|.. |..                                  :   100</span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2234, 15.5, 30]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2278, 16.5, 30] </span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2220, 15.5, 30]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [2320, 15.8, 30]</span>
<span class="sd">|..                                      :   199</span>
<span class="sd">|.. |..                                  :    99</span>
<span class="sd">|.. |.. |..                              :    49</span>
<span class="sd">|.. |.. |.. |..                          :    24  : [2451, 16.5, 20]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [3021, 15.5, 20]</span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [3425, 17.6, 20]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [3155, 16.7, 20]</span>
<span class="sd">|.. |..                                  :   100</span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [4141, 13.5, 10]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [4054, 13.2, 20]</span>
<span class="sd">|.. |.. |..                              :    50</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [4425, 11, 10]</span>
<span class="sd">|.. |.. |.. |..                          :    25  : [4129, 13, 10]</span>
<span class="sd">```</span>

<span class="sd">### Example2: as above but split on range that most divides data</span>

<span class="sd">```</span>
<span class="sd">./sublime.py -c -s $RANDOM -t xplain</span>
<span class="sd">                                                    Lbs-  Acc+  Mgg+</span>
<span class="sd">                                         :   398 : [2807, 15.5, 20]</span>
<span class="sd">198 &lt;= Lbs &lt; 454                         :   167 : [3725, 14.5, 20]</span>
<span class="sd">|.. Modl &lt; 72                            :    34 : [3609, 13,   20]</span>
<span class="sd">|.. Modl &gt;= 72                           :   133 : [3735, 14.9, 20]</span>
<span class="sd">|.. |.. Cylr &lt; 8                         :    56 : [3336, 17,   20]</span>
<span class="sd">|.. |.. |.. 77 &lt;= Modl &lt; 82              :    22 : [3410, 17.1, 20]</span>
<span class="sd">|.. |.. |.. Modl &lt; 77 or Modl &gt;= 82      :    34 : [3233, 17,   20]</span>
<span class="sd">|.. |.. Cylr &gt;= 8                        :    77 : [4129, 13.2, 20]</span>
<span class="sd">|.. |.. |.. Modl &lt; 75                    :    37 : [4274, 13,   10]</span>
<span class="sd">|.. |.. |.. Modl &gt;= 75                   :    40 : [3962, 13.5, 20]</span>
<span class="sd">|.. |.. |.. |.. Lbs &gt;= 302               :    35 : [4054, 13.2, 20]</span>
<span class="sd">Lbs &lt; 198 or Lbs &gt;= 454                  :   231 : [2290, 16,   30] &lt;== best</span>
<span class="sd">```</span>
<span class="sd"></span>
<span class="sd">## License</span>

<span class="sd">Redistribution and use in source and binary forms, with or without</span>
<span class="sd">modification, are permitted provided that the following conditions are met:</span>
<span class="sd">1. Redistributions of source code must retain the above copyright notice, this</span>
<span class="sd">   list of conditions and the following disclaimer.</span>
<span class="sd">2. Redistributions in binary form must reproduce the above copyright notice,</span>
<span class="sd">   this list of conditions and the following disclaimer in the documentation</span>
<span class="sd">   and/or other materials provided with the distribution.</span>

<span class="sd">THIS SOFTWARE IS PROVIDED BY THE COPYRIGHT HOLDERS AND CONTRIBUTORS &quot;AS IS&quot; AND</span>
<span class="sd">ANY EXPRESS OR IMPLIED WARRANTIES, INCLUDING, BUT NOT LIMITED TO, THE</span>
<span class="sd">IMPLIED WARRANTIES OF MERCHANTABILITY AND FITNESS FOR A PARTICULAR</span>
<span class="sd">PURPOSE ARE DISCLAIMED. IN NO EVENT SHALL THE COPYRIGHT HOLDER OR</span>
<span class="sd">CONTRIBUTORS BE LIABLE FOR ANY DIRECT, INDIRECT, INCIDENTAL, SPECIAL,</span>
<span class="sd">EXEMPLARY, OR CONSEQUENTIAL DAMAGES (INCLUDING, BUT NOT LIMITED TO,</span>
<span class="sd">PROCUREMENT OF SUBSTITUTE GOODS OR SERVICES; LOSS OF USE, DATA, OR</span>
<span class="sd">PROFITS; OR BUSINESS INTERRUPTION) HOWEVER CAUSED AND ON ANY THEORY OF</span>
<span class="sd">LIABILITY, WHETHER IN CONTRACT, STRICT LIABILITY, OR TORT (INCLUDING</span>
<span class="sd">NEGLIGENCE OR OTHERWISE) ARISING IN ANY WAY OUT OF THE USE OF THIS</span>
<span class="sd">SOFTWARE, EVEN IF ADVISED OF THE POSSIBILITY OF SUCH DAMAGE.</span>
<span class="sd">&quot;&quot;&quot;</span>

<span class="kn">import</span> <span class="nn">traceback</span><span class="o">,</span> <span class="nn">random</span><span class="o">,</span> <span class="nn">copy</span><span class="o">,</span> <span class="nn">math</span><span class="o">,</span> <span class="nn">sys</span><span class="o">,</span> <span class="nn">re</span>
<span class="kn">from</span> <span class="nn">random</span> <span class="kn">import</span> <span class="n">random</span> <span class="k">as</span> <span class="n">r</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Any</span>
<span class="c1">#  ___              __        </span>
<span class="c1"># /\_ \      __    /\ \       </span>
<span class="c1"># \//\ \    /\_\   \ \ \____  </span>
<span class="c1">#   \ \ \   \/\ \   \ \ &#39;__`\ </span>
<span class="c1">#    \_\ \_  \ \ \   \ \ \L\ \</span>
<span class="c1">#    /\____\  \ \_\   \ \_,__/</span>
<span class="c1">#    \/____/   \/_/    \/___/ </span>

<span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return a random item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">anywhere</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">anywhere</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
  <span class="s2">&quot;Return a random index of list `a`.&quot;</span>
  <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>

<span class="n">big</span> <span class="o">=</span> <span class="n">sys</span><span class="o">.</span><span class="n">maxsize</span>

<span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="s2">&quot;Return a number or trimmed string.&quot;</span>
  <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="k">if</span>   <span class="n">x</span><span class="o">==</span><span class="s2">&quot;True&quot;</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
  <span class="k">elif</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;False&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
  <span class="k">else</span><span class="p">:</span> 
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
 
<span class="k">def</span> <span class="nf">demo</span><span class="p">(</span><span class="n">do</span><span class="p">,</span><span class="nb">all</span><span class="p">):</span> 
  <span class="s2">&quot;Maybe run a demo, if we want it, resetting random seed first.&quot;</span>
  <span class="n">todo</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">do</span> <span class="ow">and</span> <span class="n">do</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">do</span><span class="p">)]</span>
  <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">todo</span><span class="p">:</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="nb">all</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">one</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">demo</span><span class="p">):</span>
      <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span> 
        <span class="n">fun</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PASS:&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">all</span><span class="o">.</span><span class="n">fails</span> <span class="o">+=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">the</span><span class="o">.</span><span class="n">cautious</span> <span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">();</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span>            <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FAIL:&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
  <span class="n">exit</span><span class="p">(</span><span class="nb">all</span><span class="o">.</span><span class="n">fails</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="s2">&quot;Iterator. Returns one row at a time, as cells.&quot;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span> 
      <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([\n\t\r&quot;</span><span class="se">\&#39;</span><span class="s1"> ]|#.*)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>

<span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return first item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">b4</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
  <span class="s2">&quot;While we can find similar adjacent things, merge them.&quot;</span>
  <span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">now</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">b4</span><span class="p">),[]</span>
  <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">a</span>  <span class="o">=</span> <span class="n">b4</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">merged</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">b4</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">a</span>  <span class="o">=</span> <span class="n">merged</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># we will continue, after missing one</span>
    <span class="n">now</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
  <span class="c1"># if `now` is same size as `b4`, look for any other merges.</span>
  <span class="k">return</span> <span class="n">b4</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">now</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">b4</span><span class="p">)</span> <span class="k">else</span> <span class="n">merge</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>  

<span class="k">class</span> <span class="nc">o</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="s2">&quot;Class that can pretty print its slots, with fast inits.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="n">pre</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pre</span><span class="o">+</span><span class="s1">&#39;{&#39;</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> 
                          <span class="nb">sorted</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39;?&#39;</span>

<span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="n">o</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Convert `doc` to options dictionary using command line args.</span>
<span class="sd">  Args canuse two &#39;shorthands&#39;: (1) boolean flags have no arguments (and mentioning</span>
<span class="sd">  those on the command line means &#39;flip the default value&#39;; (2) args need only</span>
<span class="sd">  mention the first few of a key (e.g. -s is enough to select for -seed).&quot;&quot;&quot;</span>
  <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;    -&quot;</span><span class="p">):</span>
       <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="c1"># get 1st,last word on each line</span>
       <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">flag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;-&quot;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
           <span class="n">x</span><span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;False&quot;</span> <span class="k">else</span><span class="p">(</span><span class="s2">&quot;False&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
       <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]:</span> <span class="n">exit</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n#.*&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)))</span>
  <span class="k">return</span> <span class="n">o</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">r</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
  <span class="s2">&quot;Return random number 0..1&quot;</span> 
  <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>

<span class="k">def</span> <span class="nf">rn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
  <span class="s2">&quot;Round a number to three decimals.&quot;</span>
  <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>

<span class="k">def</span> <span class="nf">rN</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
  <span class="s2">&quot;Round a list of numbers to three decimals.&quot;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">rn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>

<span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return second item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
<span class="c1">#          ___                                                </span>
<span class="c1">#         /\_ \                                               </span>
<span class="c1">#   ___   \//\ \       __       ____    ____     __     ____  </span>
<span class="c1">#  /&#39;___\   \ \ \    /&#39;__`\    /&#39;,__\  /&#39;,__\  /&#39;__`\  /&#39;,__\ </span>
<span class="c1"># /\ \__/    \_\ \_ /\ \L\.\_ /\__, `\/\__, `\/\  __/ /\__, `\</span>
<span class="c1"># \ \____\   /\____\\ \__/.\_\\/\____/\/\____/\ \____\\/\____/</span>
<span class="c1">#  \/____/   \/____/ \/__/\/_/ \/___/  \/___/  \/____/ \/___/ </span>
                          
<span class="c1">#   ___  _ __   __ _   _ _  </span>
<span class="c1">#  (_-&lt; | &#39;_ \ / _` | | &#39; \ </span>
<span class="c1">#  /__/ | .__/ \__,_| |_||_|</span>
<span class="c1">#       |_|                 </span>

<span class="k">class</span> <span class="nc">Span</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Given two `Sample`s and some `x` range `lo..hi`,</span>
<span class="sd">     a `Span` holds often that range appears in each `Sample`.&quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span>  <span class="n">ys</span> <span class="ow">or</span> <span class="n">Sym</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;`y` is a label identifying, one `Sample` or another.&quot;</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="c1"># -&gt; Span|None</span>
    <span class="s2">&quot;If the merged span is simpler, return that merge.&quot;</span> 
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> 
        <span class="n">c</span><span class="o">.</span><span class="n">div</span><span class="p">()</span><span class="o">*</span><span class="mf">.99</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">div</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)):</span> 
      <span class="k">return</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">),</span> <span class="n">ys</span><span class="o">=</span><span class="n">c</span><span class="p">)</span> 

  <span class="k">def</span> <span class="nf">selects</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s2">&quot;True if the range accepts the row.&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">];</span> <span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="o">&lt;=</span><span class="n">x</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span> 

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="s2">&quot;Show the range.&quot;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span>
    <span class="k">if</span> <span class="n">positive</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>

  <span class="k">def</span> <span class="nf">support</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Returns 0..1.&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">n</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="n">spans</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="s2">&quot;Good spans have large support and low diversity.&quot;</span>
    <span class="n">divs</span><span class="p">,</span> <span class="n">supports</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">supports</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">divs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>     <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
    <span class="n">f</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sn</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">.5</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
      <span class="n">divs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>    <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
      <span class="n">supports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spans</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>

<span class="c1">#              _ </span>
<span class="c1">#   __   ___  | |</span>
<span class="c1">#  / _| / _ \ | |</span>
<span class="c1">#  \__| \___/ |_|</span>

<span class="k">class</span> <span class="nc">Col</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Summarize columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">txt</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">dist1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>

<span class="c1">#   ___  _  _   _ __  </span>
<span class="c1">#  (_-&lt; | || | | &#39;  \ </span>
<span class="c1">#  /__/  \_, | |_|_|_|</span>
<span class="c1">#        |__/         </span>

<span class="k">class</span> <span class="nc">Sym</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
  <span class="s2">&quot;Summarize symbolic columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span> <span class="o">=</span> <span class="p">{},</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;Update symbol counts in `has`, updating `mode` as we go.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Distance between two symbols.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span> <span class="k">else</span> <span class="mi">1</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return diversity of this distribution (using entropy).&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1E-31</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Merge two `Sym`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using mode).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span>

  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return `x` as anything at all.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> 

  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">_bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For each symbol in `i` and `j`, count the </span>
<span class="sd">    number of times we see it on either side.&quot;&quot;&quot;</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">one</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
    <span class="nb">all</span>  <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">last</span><span class="p">:</span> 
         <span class="n">last</span> <span class="o">=</span> <span class="n">x</span>
         <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
         <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
<span class="c1">#   _ _    _  _   _ __  </span>
<span class="c1">#  | &#39; \  | || | | &#39;  \ </span>
<span class="c1">#  |_||_|  \_,_| |_|_|_|</span>

<span class="k">class</span> <span class="nc">Num</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
  <span class="s2">&quot;Summarize numeric columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="p">[],</span> <span class="mf">1E32</span><span class="p">,</span> <span class="o">-</span><span class="mf">1E32</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="kc">False</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="p">,</span><span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Reservoir sampler. If `_all` is full, sometimes replace an item at random.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span>    <span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
      <span class="k">elif</span> <span class="n">r</span><span class="p">()</span>       <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">[</span><span class="n">anywhere</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span> 
    <span class="k">return</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="s2">&quot;Return `_all`, sorted.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span>

  <span class="k">def</span> <span class="nf">dist1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span>   <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">);</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">y</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>       <span class="p">:</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Report the diversity of this distribution (using standard deviation).</span>
<span class="sd">    &amp;pm;2, 2,56, 3 &amp;sigma; is 66,90,95%, of the mass.  28&amp;sigma;. So one </span>
<span class="sd">    standard deviation is (90-10)th divide by  2.4 times &amp;sigma;.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.56</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Return two `Num`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using median).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Normalize `x` to the range 0..1.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="mf">1E-9</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">per</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="s2">&quot;Return the p-th ranked item.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">();</span> <span class="k">return</span> <span class="n">a</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="p">]</span>

  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> 
    <span class="s2">&quot;Return `x` as a float.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Divide the whole space `lo` to `hi` into, say, `xsmall`=16 bin,</span>
<span class="sd">    then count the number of times we the bin on other side.</span>
<span class="sd">    Then merge similar adjacent bins.&quot;&quot;&quot;</span>
    <span class="n">lo</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">hi</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">lo</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">one</span><span class="o">.</span><span class="n">lo</span> <span class="o">&gt;</span> <span class="n">gap</span><span class="p">:</span>
        <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
    <span class="nb">all</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="n">big</span>
    <span class="nb">all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span>  <span class="n">big</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
<span class="c1">#                      _          _        </span>
<span class="c1">#   ___  __ __  _ __  | |  __ _  (_)  _ _  </span>
<span class="c1">#  / -_) \ \ / | &#39;_ \ | | / _` | | | | &#39; \ </span>
<span class="c1">#  \___| /_\_\ | .__/ |_| \__,_| |_| |_||_|</span>
<span class="c1">#              |_|                         </span>

<span class="k">class</span> <span class="nc">Explain</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Tree with `yes`,`no` branches for samples that do/do not match a `span`.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pre</span><span class="p">:</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">:</span> 
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="p">:</span>  
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>   

<span class="c1">#        _               _               </span>
<span class="c1">#   __  | |  _  _   ___ | |_   ___   _ _ </span>
<span class="c1">#  / _| | | | || | (_-&lt; |  _| / -_) | &#39;_|</span>
<span class="c1">#  \__| |_|  \_,_| /__/  \__| \___| |_|  </span>
<span class="c1">#                                        </span>
<span class="k">class</span> <span class="nc">Cluster</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Tree with `left`,`right` samples, broken at median between far points.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">left</span>  <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">  : </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span><span class="p">]:</span> 
      <span class="k">if</span> <span class="n">kid</span><span class="p">:</span> <span class="n">kid</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
<span class="c1">#                              _       </span>
<span class="c1">#   ___  __ _   _ __    _ __  | |  ___ </span>
<span class="c1">#  (_-&lt; / _` | | &#39;  \  | &#39;_ \ | | / -_)</span>
<span class="c1">#  /__/ \__,_| |_|_|_| | .__/ |_| \___|</span>
<span class="c1">#                      |_|             </span>

<span class="k">class</span> <span class="nc">Sample</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Load, then manage, a set of examples.&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">the</span><span class="p">,</span> <span class="n">inits</span><span class="o">=</span><span class="p">[]):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">the</span> <span class="o">=</span> <span class="n">the</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span><span class="kc">None</span>
    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">inits</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">list</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pre</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">])</span> <span class="k">if</span> <span class="n">raw</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">]</span>
    <span class="n">nump</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>
    <span class="n">skipp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;:&quot;</span>
    <span class="n">klassp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="n">goalp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">klassp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1">#---------------</span>
    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">):</span> 
      <span class="n">now</span>  <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Max</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">nump</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span>
      <span class="n">where</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">goalp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">skipp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">+=</span> <span class="p">[</span><span class="n">now</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">klassp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">now</span>
      <span class="k">return</span> <span class="n">now</span>
    <span class="c1">#----------- </span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pre</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">col</span><span class="p">))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>      <span class="n">i</span><span class="o">.</span><span class="n">cols</span>  <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span> <span class="k">for</span> <span class="n">at</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">inits</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
    <span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span> 

  <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span><span class="p">):</span>
      <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
        <span class="n">here</span>       <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">left</span>  <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">])</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span> <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">far</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">rows</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">far</span><span class="p">)</span> <span class="p">]</span>

  <span class="k">def</span> <span class="nf">half</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Using two faraway points `x,y` break data at median distance.&quot;</span>
    <span class="n">some</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span><span class="p">)</span>
    <span class="n">top</span><span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">w</span>  <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">some</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">x</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">top</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">r</span><span class="p">)</span> 
                               <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)]</span>
    <span class="n">mid</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="n">mid</span><span class="p">]),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">:]),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">mid</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="s2">&quot;Find the distance of a `row` on a line between `x` and `y`.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> 

  <span class="k">def</span> <span class="nf">xplain</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Explain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">tiny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tiny</span><span class="p">:</span>
      <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="p">[</span><span class="n">lcol</span><span class="o">.</span><span class="n">spans</span><span class="p">(</span><span class="n">rcol</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">xsmall</span><span class="p">,</span><span class="n">spans</span><span class="p">)</span> <span class="k">for</span> <span class="n">lcol</span><span class="p">,</span><span class="n">rcol</span>
                                            <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">here</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">spans</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yes</span><span class="p">,</span> <span class="n">no</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="p">[(</span><span class="n">yes</span> <span class="k">if</span> <span class="n">here</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">selects</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">else</span> <span class="n">no</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yes</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">yes</span> <span class="o">=</span> <span class="n">yes</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">no</span><span class="o">.</span><span class="n">rows</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">no</span>  <span class="o">=</span> <span class="n">no</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>
<span class="c1">#    _</span>
<span class="c1">#  /\ \                                         </span>
<span class="c1">#  \_\ \      __     ___ ___      ___     ____  </span>
<span class="c1">#  /&#39;_` \   /&#39;__`\ /&#39; __` __`\   / __`\  /&#39;,__\ </span>
<span class="c1"># /\ \L\ \ /\  __/ /\ \/\ \/\ \ /\ \L\ \/\__, `\</span>
<span class="c1"># \ \___,_\\ \____\\ \_\ \_\ \_\\ \____/\/\____/</span>
<span class="c1">#  \/__,_ / \/____/ \/_/\/_/\/_/ \/___/  \/___/ </span>

<span class="k">class</span> <span class="nc">Demos</span><span class="p">:</span>
  <span class="s2">&quot;Possible start-up actions.&quot;</span>
  <span class="n">fails</span><span class="o">=</span><span class="mi">0</span>
  <span class="k">def</span> <span class="nf">opt</span><span class="p">():</span> 
    <span class="s2">&quot;show the config.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">seed</span><span class="p">():</span>
    <span class="s2">&quot;seed&quot;</span>
    <span class="k">assert</span> <span class="mf">.494</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.495</span> 

  <span class="k">def</span> <span class="nf">num</span><span class="p">():</span> 
    <span class="s2">&quot;check `Num`.&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span> <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">())</span>
    <span class="k">assert</span> <span class="mf">.30</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.31</span><span class="p">,</span> <span class="s2">&quot;in range&quot;</span>

  <span class="k">def</span> <span class="nf">sym</span><span class="p">():</span> 
    <span class="s2">&quot;check `Sym`.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">&quot;aaaabbc&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">1.37</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.38</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;a&#39;</span>  <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">mid</span><span class="p">(),</span> <span class="s2">&quot;mode&quot;</span>

  <span class="k">def</span> <span class="nf">rows</span><span class="p">():</span> 
    <span class="s2">&quot;count rows in a file.&quot;</span>
    <span class="k">assert</span> <span class="mi">399</span> <span class="o">==</span> <span class="nb">len</span><span class="p">([</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)])</span>

  <span class="k">def</span> <span class="nf">sample</span><span class="p">():</span> 
    <span class="s2">&quot;sampling.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
    <span class="k">assert</span> <span class="mi">398</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span>    <span class="s2">&quot;length of rows&quot;</span>
    <span class="k">assert</span> <span class="mi">249</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="s2">&quot;symbol counts&quot;</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">():</span> 
    <span class="s2">&quot;distance between rows&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">.84</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">.842</span>

  <span class="k">def</span> <span class="nf">far</span><span class="p">():</span>
    <span class="s2">&quot;distant items&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
      <span class="n">a</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
      <span class="k">assert</span> <span class="n">a</span><span class="o">&gt;</span><span class="mf">.5</span><span class="p">,</span> <span class="s2">&quot;large?&quot;</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">():</span>
    <span class="s2">&quot;cloning&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">d1</span><span class="p">,</span><span class="n">d2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
      <span class="k">assert</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;clone test&quot;</span>

  <span class="k">def</span> <span class="nf">half</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">cluster</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">xplain</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">xplain</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

<span class="c1">#---------------------------------------------------</span>
<span class="n">the</span><span class="o">=</span><span class="n">options</span><span class="p">(</span><span class="vm">__doc__</span><span class="p">)</span>
<span class="k">if</span> <span class="vm">__name__</span> <span class="o">==</span> <span class="s2">&quot;__main__&quot;</span><span class="p">:</span> <span class="n">demo</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">todo</span><span class="p">,</span><span class="n">Demos</span><span class="p">)</span>

<span class="sd">&quot;&quot;&quot;</span>
<span class="sd">Example class</span>
<span class="sd">&quot;&quot;&quot;</span>
</pre></div>

        </details>

            </section>
                <section id="any">
                            <div class="attr function"><a class="headerlink" href="#any">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">any</span><span class="signature">(a: list) -&gt; Any</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">any</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return a random item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="n">anywhere</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return a random item.</p>
</div>


                </section>
                <section id="anywhere">
                            <div class="attr function"><a class="headerlink" href="#anywhere">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">anywhere</span><span class="signature">(a: list) -&gt; int</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">anywhere</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
  <span class="s2">&quot;Return a random index of list `a`.&quot;</span>
  <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">randint</span><span class="p">(</span><span class="mi">0</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">)</span><span class="o">-</span><span class="mi">1</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return a random index of list <code>a</code>.</p>
</div>


                </section>
                <section id="atom">
                            <div class="attr function"><a class="headerlink" href="#atom">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">atom</span><span class="signature">(x)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">atom</span><span class="p">(</span><span class="n">x</span><span class="p">):</span>
  <span class="s2">&quot;Return a number or trimmed string.&quot;</span>
  <span class="n">x</span><span class="o">=</span><span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
  <span class="k">if</span>   <span class="n">x</span><span class="o">==</span><span class="s2">&quot;True&quot;</span> <span class="p">:</span> <span class="k">return</span> <span class="kc">True</span>
  <span class="k">elif</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;False&quot;</span><span class="p">:</span> <span class="k">return</span> <span class="kc">False</span>
  <span class="k">else</span><span class="p">:</span> 
    <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">except</span><span class="p">:</span>
      <span class="k">try</span><span class="p">:</span> <span class="k">return</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
      <span class="k">except</span><span class="p">:</span> <span class="k">return</span> <span class="n">x</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return a number or trimmed string.</p>
</div>


                </section>
                <section id="demo">
                            <div class="attr function"><a class="headerlink" href="#demo">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">demo</span><span class="signature">(do, all)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">demo</span><span class="p">(</span><span class="n">do</span><span class="p">,</span><span class="nb">all</span><span class="p">):</span> 
  <span class="s2">&quot;Maybe run a demo, if we want it, resetting random seed first.&quot;</span>
  <span class="n">todo</span> <span class="o">=</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">do</span> <span class="ow">and</span> <span class="n">do</span> <span class="o">!=</span> <span class="s2">&quot;all&quot;</span><span class="p">:</span>
    <span class="n">todo</span> <span class="o">=</span> <span class="p">[</span><span class="n">x</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="nb">dir</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="k">if</span> <span class="n">x</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">do</span><span class="p">)]</span>
  <span class="k">for</span> <span class="n">one</span> <span class="ow">in</span> <span class="n">todo</span><span class="p">:</span>
    <span class="n">fun</span> <span class="o">=</span> <span class="nb">all</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">one</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">type</span><span class="p">(</span><span class="n">fun</span><span class="p">)</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">demo</span><span class="p">):</span>
      <span class="n">random</span><span class="o">.</span><span class="n">seed</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">seed</span><span class="p">)</span>
      <span class="n">doc</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s2">&quot;\n\s+&quot;</span><span class="p">,</span> <span class="s2">&quot;</span><span class="se">\n</span><span class="s2">&quot;</span><span class="p">,</span> <span class="n">fun</span><span class="o">.</span><span class="vm">__doc__</span> <span class="ow">or</span> <span class="s2">&quot;&quot;</span><span class="p">)</span>
      <span class="k">try</span><span class="p">:</span> 
        <span class="n">fun</span><span class="p">()</span>
        <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;PASS:&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">)</span>
      <span class="k">except</span> <span class="ne">Exception</span> <span class="k">as</span> <span class="n">e</span><span class="p">:</span>
        <span class="nb">all</span><span class="o">.</span><span class="n">fails</span> <span class="o">+=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">the</span><span class="o">.</span><span class="n">cautious</span> <span class="p">:</span> <span class="n">traceback</span><span class="o">.</span><span class="n">print_exc</span><span class="p">();</span> <span class="n">exit</span><span class="p">(</span><span class="mi">1</span><span class="p">)</span>
        <span class="k">else</span>            <span class="p">:</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;FAIL:&quot;</span><span class="p">,</span> <span class="n">doc</span><span class="p">,</span> <span class="n">e</span><span class="p">)</span>
  <span class="n">exit</span><span class="p">(</span><span class="nb">all</span><span class="o">.</span><span class="n">fails</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Maybe run a demo, if we want it, resetting random seed first.</p>
</div>


                </section>
                <section id="file">
                            <div class="attr function"><a class="headerlink" href="#file">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">file</span><span class="signature">(f)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">file</span><span class="p">(</span><span class="n">f</span><span class="p">):</span>
  <span class="s2">&quot;Iterator. Returns one row at a time, as cells.&quot;</span>
  <span class="k">with</span> <span class="nb">open</span><span class="p">(</span><span class="n">f</span><span class="p">)</span> <span class="k">as</span> <span class="n">fp</span><span class="p">:</span>
    <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">fp</span><span class="p">:</span> 
      <span class="n">line</span> <span class="o">=</span> <span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;([\n\t\r&quot;</span><span class="se">\&#39;</span><span class="s1"> ]|#.*)&#39;</span><span class="p">,</span> <span class="s1">&#39;&#39;</span><span class="p">,</span> <span class="n">line</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">line</span><span class="p">:</span>
        <span class="k">yield</span> <span class="p">[</span><span class="n">cell</span><span class="o">.</span><span class="n">strip</span><span class="p">()</span> <span class="k">for</span> <span class="n">cell</span> <span class="ow">in</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;,&quot;</span><span class="p">)]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Iterator. Returns one row at a time, as cells.</p>
</div>


                </section>
                <section id="first">
                            <div class="attr function"><a class="headerlink" href="#first">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">first</span><span class="signature">(a: list) -&gt; Any</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">first</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return first item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return first item.</p>
</div>


                </section>
                <section id="merge">
                            <div class="attr function"><a class="headerlink" href="#merge">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">merge</span><span class="signature">(b4: list) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">b4</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
  <span class="s2">&quot;While we can find similar adjacent things, merge them.&quot;</span>
  <span class="n">j</span><span class="p">,</span><span class="n">n</span><span class="p">,</span><span class="n">now</span> <span class="o">=</span> <span class="o">-</span><span class="mi">1</span><span class="p">,</span><span class="nb">len</span><span class="p">(</span><span class="n">b4</span><span class="p">),[]</span>
  <span class="k">while</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">1</span><span class="p">:</span>
    <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span>
    <span class="n">a</span>  <span class="o">=</span> <span class="n">b4</span><span class="p">[</span><span class="n">j</span><span class="p">]</span>
    <span class="k">if</span> <span class="n">j</span> <span class="o">&lt;</span> <span class="n">n</span><span class="o">-</span><span class="mi">2</span><span class="p">:</span>
      <span class="k">if</span> <span class="n">merged</span> <span class="o">:=</span> <span class="n">a</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">b4</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">]):</span>
        <span class="n">a</span>  <span class="o">=</span> <span class="n">merged</span>
        <span class="n">j</span> <span class="o">+=</span> <span class="mi">1</span> <span class="c1"># we will continue, after missing one</span>
    <span class="n">now</span> <span class="o">+=</span> <span class="p">[</span><span class="n">a</span><span class="p">]</span>
  <span class="c1"># if `now` is same size as `b4`, look for any other merges.</span>
  <span class="k">return</span> <span class="n">b4</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">now</span><span class="p">)</span><span class="o">==</span><span class="nb">len</span><span class="p">(</span><span class="n">b4</span><span class="p">)</span> <span class="k">else</span> <span class="n">merge</span><span class="p">(</span><span class="n">now</span><span class="p">)</span>  
</pre></div>

        </details>

            <div class="docstring"><p>While we can find similar adjacent things, merge them.</p>
</div>


                </section>
                <section id="o">
                                <div class="attr class">
        <a class="headerlink" href="#o">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">o</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">o</span><span class="p">(</span><span class="nb">object</span><span class="p">):</span>
  <span class="s2">&quot;Class that can pretty print its slots, with fast inits.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
  <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="n">pre</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="vm">__class__</span><span class="o">.</span><span class="vm">__name__</span> <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">o</span><span class="p">)</span> <span class="k">else</span> <span class="s2">&quot;&quot;</span>
    <span class="k">return</span> <span class="n">pre</span><span class="o">+</span><span class="s1">&#39;{&#39;</span><span class="o">+</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="sa">f</span><span class="s2">&quot;:</span><span class="si">{</span><span class="n">k</span><span class="si">}</span><span class="s2"> </span><span class="si">{</span><span class="n">v</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">for</span> <span class="n">k</span><span class="p">,</span> <span class="n">v</span> <span class="ow">in</span> 
                          <span class="nb">sorted</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">items</span><span class="p">())</span> <span class="k">if</span> <span class="nb">str</span><span class="p">(</span><span class="n">k</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span> <span class="o">!=</span> <span class="s2">&quot;_&quot;</span><span class="p">]))</span><span class="o">+</span><span class="s1">&#39;?&#39;</span>
</pre></div>

        </details>

            <div class="docstring"><p>Class that can pretty print its slots, with fast inits.</p>
</div>


                            <div id="o.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#o.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">o</span><span class="signature">(**d)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="o">**</span><span class="n">d</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="vm">__dict__</span><span class="o">.</span><span class="n">update</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                </section>
                <section id="options">
                            <div class="attr function"><a class="headerlink" href="#options">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">options</span><span class="signature">(doc: str) -&gt; <a href="#o">sublime.o</a></span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">options</span><span class="p">(</span><span class="n">doc</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="n">o</span><span class="p">:</span>
  <span class="sd">&quot;&quot;&quot;Convert `doc` to options dictionary using command line args.</span>
<span class="sd">  Args canuse two &#39;shorthands&#39;: (1) boolean flags have no arguments (and mentioning</span>
<span class="sd">  those on the command line means &#39;flip the default value&#39;; (2) args need only</span>
<span class="sd">  mention the first few of a key (e.g. -s is enough to select for -seed).&quot;&quot;&quot;</span>
  <span class="n">d</span><span class="o">=</span><span class="p">{}</span>
  <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">doc</span><span class="o">.</span><span class="n">splitlines</span><span class="p">():</span>
    <span class="k">if</span> <span class="n">line</span> <span class="ow">and</span> <span class="n">line</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="s2">&quot;    -&quot;</span><span class="p">):</span>
       <span class="n">key</span><span class="p">,</span> <span class="o">*</span><span class="n">_</span><span class="p">,</span> <span class="n">x</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">strip</span><span class="p">()[</span><span class="mi">1</span><span class="p">:]</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot; &quot;</span><span class="p">)</span> <span class="c1"># get 1st,last word on each line</span>
       <span class="k">for</span> <span class="n">j</span><span class="p">,</span><span class="n">flag</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">):</span>
         <span class="k">if</span> <span class="n">flag</span> <span class="ow">and</span> <span class="n">flag</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;-&quot;</span> <span class="ow">and</span> <span class="n">key</span><span class="o">.</span><span class="n">startswith</span><span class="p">(</span><span class="n">flag</span><span class="p">[</span><span class="mi">1</span><span class="p">:]):</span>
           <span class="n">x</span><span class="o">=</span> <span class="s2">&quot;True&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;False&quot;</span> <span class="k">else</span><span class="p">(</span><span class="s2">&quot;False&quot;</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;True&quot;</span> <span class="k">else</span> <span class="n">sys</span><span class="o">.</span><span class="n">argv</span><span class="p">[</span><span class="n">j</span><span class="o">+</span><span class="mi">1</span><span class="p">])</span>
       <span class="n">d</span><span class="p">[</span><span class="n">key</span><span class="p">]</span> <span class="o">=</span> <span class="n">atom</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
  <span class="k">if</span> <span class="n">d</span><span class="p">[</span><span class="s2">&quot;help&quot;</span><span class="p">]:</span> <span class="n">exit</span><span class="p">(</span><span class="nb">print</span><span class="p">(</span><span class="n">re</span><span class="o">.</span><span class="n">sub</span><span class="p">(</span><span class="sa">r</span><span class="s1">&#39;\n#.*&#39;</span><span class="p">,</span><span class="s2">&quot;&quot;</span><span class="p">,</span><span class="n">doc</span><span class="p">,</span><span class="n">flags</span><span class="o">=</span><span class="n">re</span><span class="o">.</span><span class="n">S</span><span class="p">)))</span>
  <span class="k">return</span> <span class="n">o</span><span class="p">(</span><span class="o">**</span><span class="n">d</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Convert <code>doc</code> to options dictionary using command line args.
Args canuse two 'shorthands': (1) boolean flags have no arguments (and mentioning
those on the command line means 'flip the default value'; (2) args need only
mention the first few of a key (e.g. -s is enough to select for -seed).</p>
</div>


                </section>
                <section id="r">
                            <div class="attr function"><a class="headerlink" href="#r">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">r</span><span class="signature">() -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">r</span><span class="p">()</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
  <span class="s2">&quot;Return random number 0..1&quot;</span> 
  <span class="k">return</span> <span class="n">random</span><span class="o">.</span><span class="n">random</span><span class="p">()</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return random number 0..1</p>
</div>


                </section>
                <section id="rn">
                            <div class="attr function"><a class="headerlink" href="#rn">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">rn</span><span class="signature">(x: float, n=3) -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rn</span><span class="p">(</span><span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
  <span class="s2">&quot;Round a number to three decimals.&quot;</span>
  <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Round a number to three decimals.</p>
</div>


                </section>
                <section id="rN">
                            <div class="attr function"><a class="headerlink" href="#rN">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">rN</span><span class="signature">(a: list, n=3) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">rN</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">,</span> <span class="n">n</span><span class="o">=</span><span class="mi">3</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
  <span class="s2">&quot;Round a list of numbers to three decimals.&quot;</span>
  <span class="k">return</span> <span class="p">[</span><span class="n">rn</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="o">=</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">a</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Round a list of numbers to three decimals.</p>
</div>


                </section>
                <section id="second">
                            <div class="attr function"><a class="headerlink" href="#second">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">second</span><span class="signature">(a: list) -&gt; Any</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">def</span> <span class="nf">second</span><span class="p">(</span><span class="n">a</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span>
  <span class="s2">&quot;Return second item.&quot;</span>
  <span class="k">return</span> <span class="n">a</span><span class="p">[</span><span class="mi">1</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return second item.</p>
</div>


                </section>
                <section id="Span">
                                <div class="attr class">
        <a class="headerlink" href="#Span">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Span</span><wbr>(<span class="base"><a href="#o">o</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Span</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="sd">&quot;&quot;&quot;Given two `Sample`s and some `x` range `lo..hi`,</span>
<span class="sd">     a `Span` holds often that range appears in each `Sample`.&quot;&quot;&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span>  <span class="n">ys</span> <span class="ow">or</span> <span class="n">Sym</span><span class="p">()</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;`y` is a label identifying, one `Sample` or another.&quot;</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="c1"># -&gt; Span|None</span>
    <span class="s2">&quot;If the merged span is simpler, return that merge.&quot;</span> 
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> 
        <span class="n">c</span><span class="o">.</span><span class="n">div</span><span class="p">()</span><span class="o">*</span><span class="mf">.99</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">div</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)):</span> 
      <span class="k">return</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">),</span> <span class="n">ys</span><span class="o">=</span><span class="n">c</span><span class="p">)</span> 

  <span class="k">def</span> <span class="nf">selects</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s2">&quot;True if the range accepts the row.&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">];</span> <span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="o">&lt;=</span><span class="n">x</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span> 

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="s2">&quot;Show the range.&quot;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span>
    <span class="k">if</span> <span class="n">positive</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>

  <span class="k">def</span> <span class="nf">support</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Returns 0..1.&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">n</span>

  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="n">spans</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="s2">&quot;Good spans have large support and low diversity.&quot;</span>
    <span class="n">divs</span><span class="p">,</span> <span class="n">supports</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">supports</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">divs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>     <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
    <span class="n">f</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sn</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">.5</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
      <span class="n">divs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>    <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
      <span class="n">supports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spans</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Given two <code><a href="#Sample">Sample</a></code>s and some <code>x</code> range <code>lo..hi</code>,
a <code><a href="#Span">Span</a></code> holds often that range appears in each <code><a href="#Sample">Sample</a></code>.</p>
</div>


                            <div id="Span.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Span</span><span class="signature">(col, lo, hi, ys=None)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span> <span class="n">ys</span><span class="o">=</span><span class="kc">None</span><span class="p">,):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span> <span class="o">=</span> <span class="n">col</span><span class="p">,</span> <span class="n">lo</span><span class="p">,</span> <span class="n">hi</span><span class="p">,</span>  <span class="n">ys</span> <span class="ow">or</span> <span class="n">Sym</span><span class="p">()</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Span.add" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.add">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">add</span><span class="signature">(i, x: float, y: Any, inc=1) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">float</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span>
    <span class="s2">&quot;`y` is a label identifying, one `Sample` or another.&quot;</span>
    <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">y</span><span class="p">,</span><span class="n">inc</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p><code>y</code> is a label identifying, one <code><a href="#Sample">Sample</a></code> or another.</p>
</div>


                            </div>
                            <div id="Span.merge" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.merge">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">merge</span><span class="signature">(i, j)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">j</span><span class="p">):</span> <span class="c1"># -&gt; Span|None</span>
    <span class="s2">&quot;If the merged span is simpler, return that merge.&quot;</span> 
    <span class="n">a</span><span class="p">,</span> <span class="n">b</span><span class="p">,</span> <span class="n">c</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">merge</span><span class="p">(</span><span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="p">)</span>
    <span class="k">if</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> <span class="n">j</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span><span class="o">==</span><span class="mi">0</span> <span class="ow">or</span> 
        <span class="n">c</span><span class="o">.</span><span class="n">div</span><span class="p">()</span><span class="o">*</span><span class="mf">.99</span> <span class="o">&lt;=</span> <span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">a</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="o">*</span><span class="n">b</span><span class="o">.</span><span class="n">div</span><span class="p">())</span><span class="o">/</span><span class="p">(</span><span class="n">a</span><span class="o">.</span><span class="n">n</span> <span class="o">+</span> <span class="n">b</span><span class="o">.</span><span class="n">n</span><span class="p">)):</span> 
      <span class="k">return</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="p">,</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">),</span><span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">),</span> <span class="n">ys</span><span class="o">=</span><span class="n">c</span><span class="p">)</span> 
</pre></div>

        </details>

            <div class="docstring"><p>If the merged span is simpler, return that merge.</p>
</div>


                            </div>
                            <div id="Span.selects" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.selects">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">selects</span><span class="signature">(i, row: list) -&gt; bool</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">selects</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">:</span><span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">bool</span><span class="p">:</span>
    <span class="s2">&quot;True if the range accepts the row.&quot;</span>
    <span class="n">x</span> <span class="o">=</span> <span class="n">row</span><span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">];</span> <span class="k">return</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="o">&lt;=</span><span class="n">x</span> <span class="ow">and</span> <span class="n">x</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span> 
</pre></div>

        </details>

            <div class="docstring"><p>True if the range accepts the row.</p>
</div>


                            </div>
                            <div id="Span.show" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.show">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">show</span><span class="signature">(i, positive=True) -&gt; None</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">positive</span><span class="o">=</span><span class="kc">True</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="kc">None</span><span class="p">:</span> 
    <span class="s2">&quot;Show the range.&quot;</span>
    <span class="n">txt</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span>
    <span class="k">if</span> <span class="n">positive</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> == </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> &lt;= </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="k">else</span><span class="p">:</span>
      <span class="k">if</span>   <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> != </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">==</span> <span class="o">-</span><span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">elif</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">==</span>  <span class="n">big</span><span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2">&quot;</span>
      <span class="k">else</span>             <span class="p">:</span> <span class="k">return</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &lt; </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="si">}</span><span class="s2"> or </span><span class="si">{</span><span class="n">txt</span><span class="si">}</span><span class="s2"> &gt;= </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="si">}</span><span class="s2">&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>Show the range.</p>
</div>


                            </div>
                            <div id="Span.support" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.support">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">support</span><span class="signature">(i) -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">support</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Returns 0..1.&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">n</span> <span class="o">/</span> <span class="n">i</span><span class="o">.</span><span class="n">col</span><span class="o">.</span><span class="n">n</span>
</pre></div>

        </details>

            <div class="docstring"><p>Returns 0..1.</p>
</div>


                            </div>
                            <div id="Span.sort" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Span.sort">#&nbsp;&nbsp</a>

                <div class="decorator">@staticmethod</div>

            <span class="def">def</span>
            <span class="name">sort</span><span class="signature">(spans: list) -&gt; list</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="nd">@staticmethod</span>
  <span class="k">def</span> <span class="nf">sort</span><span class="p">(</span><span class="n">spans</span> <span class="p">:</span> <span class="nb">list</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">list</span><span class="p">:</span>
    <span class="s2">&quot;Good spans have large support and low diversity.&quot;</span>
    <span class="n">divs</span><span class="p">,</span> <span class="n">supports</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">),</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="n">sn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">supports</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span> <span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="n">dn</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="n">divs</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span>     <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
    <span class="n">f</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">s</span><span class="p">:</span> <span class="p">((</span><span class="mi">1</span> <span class="o">-</span> <span class="n">sn</span><span class="p">(</span><span class="n">s</span><span class="p">))</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">dn</span><span class="p">(</span><span class="n">s</span><span class="p">)</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span><span class="o">**</span><span class="mf">.5</span><span class="o">/</span><span class="mi">2</span><span class="o">**</span><span class="mf">.5</span>
    <span class="k">for</span> <span class="n">s</span> <span class="ow">in</span> <span class="n">spans</span><span class="p">:</span>
      <span class="n">divs</span><span class="o">.</span><span class="n">add</span><span class="p">(</span>    <span class="n">s</span><span class="o">.</span><span class="n">ys</span><span class="o">.</span><span class="n">div</span><span class="p">())</span>
      <span class="n">supports</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">support</span><span class="p">())</span>
    <span class="k">return</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">spans</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">f</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Good spans have large support and low diversity.</p>
</div>


                            </div>
                </section>
                <section id="Col">
                                <div class="attr class">
        <a class="headerlink" href="#Col">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Col</span><wbr>(<span class="base"><a href="#o">o</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Col</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Summarize columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">txt</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">dist1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Summarize columns.</p>
</div>


                            <div id="Col.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Col.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Col</span><span class="signature">(at=0, txt=&#39;&#39;)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">w</span><span class="o">=</span><span class="mi">0</span><span class="p">,</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">,(</span><span class="o">-</span><span class="mi">1</span> <span class="k">if</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">txt</span> <span class="k">else</span> <span class="mi">1</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Col.dist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Col.dist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dist</span><span class="signature">(i, x: Any, y: Any) -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="n">Any</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="n">Any</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span> 
    <span class="k">return</span> <span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="ow">and</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">dist1</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                </section>
                <section id="Sym">
                                <div class="attr class">
        <a class="headerlink" href="#Sym">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Sym</span><wbr>(<span class="base"><a href="#Col">Col</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Sym</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
  <span class="s2">&quot;Summarize symbolic columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span> <span class="o">=</span> <span class="p">{},</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;Update symbol counts in `has`, updating `mode` as we go.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Distance between two symbols.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span> <span class="k">else</span> <span class="mi">1</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return diversity of this distribution (using entropy).&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1E-31</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Merge two `Sym`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using mode).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span>

  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return `x` as anything at all.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> 

  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">_bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For each symbol in `i` and `j`, count the </span>
<span class="sd">    number of times we see it on either side.&quot;&quot;&quot;</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">one</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
    <span class="nb">all</span>  <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">last</span><span class="p">:</span> 
         <span class="n">last</span> <span class="o">=</span> <span class="n">x</span>
         <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
         <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
</pre></div>

        </details>

            <div class="docstring"><p>Summarize symbolic columns.</p>
</div>


                            <div id="Sym.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Sym</span><span class="signature">(**kw)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span> <span class="o">=</span> <span class="p">{},</span> <span class="kc">None</span><span class="p">,</span> <span class="mi">0</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sym.add" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.add">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">add</span><span class="signature">(i, x: str, inc: int = 1) -&gt; str</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">inc</span><span class="p">:</span><span class="nb">int</span><span class="o">=</span><span class="mi">1</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="s2">&quot;Update symbol counts in `has`, updating `mode` as we go.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">tmp</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="n">x</span><span class="p">]</span> <span class="o">=</span> <span class="n">inc</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">get</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="mi">0</span><span class="p">)</span>
      <span class="k">if</span> <span class="n">tmp</span> <span class="o">&gt;</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">most</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span> <span class="o">=</span> <span class="n">tmp</span><span class="p">,</span> <span class="n">x</span>
    <span class="k">return</span> <span class="n">x</span>
</pre></div>

        </details>

            <div class="docstring"><p>Update symbol counts in <code>has</code>, updating <code>mode</code> as we go.</p>
</div>


                            </div>
                            <div id="Sym.dist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.dist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dist</span><span class="signature">(i, x: str, y: str) -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span><span class="nb">str</span><span class="p">,</span> <span class="n">y</span><span class="p">:</span><span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span><span class="nb">float</span><span class="p">:</span> 
    <span class="s2">&quot;Distance between two symbols.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="n">y</span> <span class="k">else</span> <span class="mi">1</span>
</pre></div>

        </details>

            <div class="docstring"><p>Distance between two symbols.</p>
</div>


                            </div>
                            <div id="Sym.div" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.div">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">div</span><span class="signature">(i)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return diversity of this distribution (using entropy).&quot;</span>
    <span class="n">p</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span><span class="p">:</span> <span class="n">x</span> <span class="o">/</span> <span class="p">(</span><span class="mf">1E-31</span> <span class="o">+</span> <span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">sum</span><span class="p">(</span> <span class="o">-</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">)</span><span class="o">*</span><span class="n">math</span><span class="o">.</span><span class="n">log</span><span class="p">(</span><span class="n">p</span><span class="p">(</span><span class="n">x</span><span class="p">),</span><span class="mi">2</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">values</span><span class="p">()</span> <span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return diversity of this distribution (using entropy).</p>
</div>


                            </div>
                            <div id="Sym.merge" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.merge">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">merge</span><span class="signature">(i, j)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Merge two `Sym`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>
</pre></div>

        </details>

            <div class="docstring"><p>Merge two <code><a href="#Sym">Sym</a></code>s.</p>
</div>


                            </div>
                            <div id="Sym.mid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.mid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">mid</span><span class="signature">(i) -&gt; Any</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using mode).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">mode</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return central tendency of this distribution (using mode).</p>
</div>


                            </div>
                            <div id="Sym.prep" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.prep">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">prep</span><span class="signature">(i, x) -&gt; Any</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Any</span><span class="p">:</span> 
    <span class="s2">&quot;Return `x` as anything at all.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> 
</pre></div>

        </details>

            <div class="docstring"><p>Return <code>x</code> as anything at all.</p>
</div>


                            </div>
                            <div id="Sym.spans" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sym.spans">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">spans</span><span class="signature">(i, j, _bins, out)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">_bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;For each symbol in `i` and `j`, count the </span>
<span class="sd">    number of times we see it on either side.&quot;&quot;&quot;</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="n">n</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">has</span><span class="o">.</span><span class="n">items</span><span class="p">()]</span>
    <span class="n">one</span><span class="p">,</span> <span class="n">last</span> <span class="o">=</span> <span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
    <span class="nb">all</span>  <span class="o">=</span> <span class="p">[]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="n">last</span><span class="p">:</span> 
         <span class="n">last</span> <span class="o">=</span> <span class="n">x</span>
         <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
         <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span> <span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
</pre></div>

        </details>

            <div class="docstring"><p>For each symbol in <code>i</code> and <code>j</code>, count the 
number of times we see it on either side.</p>
</div>


                            </div>
                </section>
                <section id="Num">
                                <div class="attr class">
        <a class="headerlink" href="#Num">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Num</span><wbr>(<span class="base"><a href="#Col">Col</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Num</span><span class="p">(</span><span class="n">Col</span><span class="p">):</span>
  <span class="s2">&quot;Summarize numeric columns.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="p">[],</span> <span class="mf">1E32</span><span class="p">,</span> <span class="o">-</span><span class="mf">1E32</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="kc">False</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="p">,</span><span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Reservoir sampler. If `_all` is full, sometimes replace an item at random.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span>    <span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
      <span class="k">elif</span> <span class="n">r</span><span class="p">()</span>       <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">[</span><span class="n">anywhere</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span> 
    <span class="k">return</span> <span class="n">x</span>

  <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="s2">&quot;Return `_all`, sorted.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span>

  <span class="k">def</span> <span class="nf">dist1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span>   <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">);</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">y</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>       <span class="p">:</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Report the diversity of this distribution (using standard deviation).</span>
<span class="sd">    &amp;pm;2, 2,56, 3 &amp;sigma; is 66,90,95%, of the mass.  28&amp;sigma;. So one </span>
<span class="sd">    standard deviation is (90-10)th divide by  2.4 times &amp;sigma;.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.56</span>

  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Return two `Num`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using median).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Normalize `x` to the range 0..1.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="mf">1E-9</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">per</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="s2">&quot;Return the p-th ranked item.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">();</span> <span class="k">return</span> <span class="n">a</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="p">]</span>

  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> 
    <span class="s2">&quot;Return `x` as a float.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Divide the whole space `lo` to `hi` into, say, `xsmall`=16 bin,</span>
<span class="sd">    then count the number of times we the bin on other side.</span>
<span class="sd">    Then merge similar adjacent bins.&quot;&quot;&quot;</span>
    <span class="n">lo</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">hi</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">lo</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">one</span><span class="o">.</span><span class="n">lo</span> <span class="o">&gt;</span> <span class="n">gap</span><span class="p">:</span>
        <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
    <span class="nb">all</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="n">big</span>
    <span class="nb">all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span>  <span class="n">big</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
</pre></div>

        </details>

            <div class="docstring"><p>Summarize numeric columns.</p>
</div>


                            <div id="Num.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Num</span><span class="signature">(size, **kw)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">size</span><span class="p">,</span><span class="o">**</span><span class="n">kw</span><span class="p">):</span>
    <span class="nb">super</span><span class="p">()</span><span class="o">.</span><span class="fm">__init__</span><span class="p">(</span><span class="o">**</span><span class="n">kw</span><span class="p">)</span>
    <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span> <span class="o">=</span> <span class="p">[],</span> <span class="mf">1E32</span><span class="p">,</span> <span class="o">-</span><span class="mf">1E32</span><span class="p">,</span> <span class="n">size</span><span class="p">,</span> <span class="kc">False</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Num.add" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.add">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">add</span><span class="signature">(i, x: float, inc=1)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">:</span> <span class="nb">float</span> <span class="p">,</span><span class="n">inc</span><span class="o">=</span><span class="mi">1</span><span class="p">):</span>
    <span class="s2">&quot;Reservoir sampler. If `_all` is full, sometimes replace an item at random.&quot;</span>
    <span class="k">if</span> <span class="n">x</span> <span class="o">!=</span> <span class="s2">&quot;?&quot;</span><span class="p">:</span>
      <span class="n">i</span><span class="o">.</span><span class="n">n</span> <span class="o">+=</span> <span class="n">inc</span>
      <span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)</span> <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span>    <span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">x</span><span class="p">]</span>
      <span class="k">elif</span> <span class="n">r</span><span class="p">()</span>       <span class="o">&lt;</span> <span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">n</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">False</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">[</span><span class="n">anywhere</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">)]</span> <span class="o">=</span> <span class="n">x</span> 
    <span class="k">return</span> <span class="n">x</span>
</pre></div>

        </details>

            <div class="docstring"><p>Reservoir sampler. If <code>_all</code> is full, sometimes replace an item at random.</p>
</div>


                            </div>
                            <div id="Num.all" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.all">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">all</span><span class="signature">(i)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">all</span><span class="p">(</span><span class="n">i</span><span class="p">):</span>
    <span class="s2">&quot;Return `_all`, sorted.&quot;</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">ok</span><span class="o">=</span><span class="kc">True</span><span class="p">;</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="o">.</span><span class="n">sort</span><span class="p">()</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return <code>_all</code>, sorted.</p>
</div>


                            </div>
                            <div id="Num.dist1" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.dist1">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dist1</span><span class="signature">(i, x, y)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">dist1</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="k">if</span>   <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">y</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">);</span> <span class="n">x</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">y</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">elif</span> <span class="n">y</span><span class="o">==</span><span class="s2">&quot;?&quot;</span><span class="p">:</span> <span class="n">x</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">);</span> <span class="n">y</span><span class="o">=</span><span class="p">(</span><span class="mi">1</span> <span class="k">if</span> <span class="n">x</span><span class="o">&lt;</span><span class="mf">.5</span> <span class="k">else</span> <span class="mi">0</span><span class="p">)</span>
    <span class="k">else</span>       <span class="p">:</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">x</span><span class="p">),</span> <span class="n">i</span><span class="o">.</span><span class="n">norm</span><span class="p">(</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">abs</span><span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">y</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Num.div" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.div">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">div</span><span class="signature">(i)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="sd">&quot;&quot;&quot;Report the diversity of this distribution (using standard deviation).</span>
<span class="sd">    &amp;pm;2, 2,56, 3 &amp;sigma; is 66,90,95%, of the mass.  28&amp;sigma;. So one </span>
<span class="sd">    standard deviation is (90-10)th divide by  2.4 times &amp;sigma;.&quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.9</span><span class="p">)</span> <span class="o">-</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.1</span><span class="p">))</span> <span class="o">/</span> <span class="mf">2.56</span>
</pre></div>

        </details>

            <div class="docstring"><p>Report the diversity of this distribution (using standard deviation).
&pm;2, 2,56, 3 &sigma; is 66,90,95%, of the mass.  28&sigma;. So one 
standard deviation is (90-10)th divide by  2.4 times &sigma;.</p>
</div>


                            </div>
                            <div id="Num.merge" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.merge">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">merge</span><span class="signature">(i, j)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">merge</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">):</span>
    <span class="s2">&quot;Return two `Num`s.&quot;</span>
    <span class="n">k</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">max</span><span class="p">,</span> <span class="n">at</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">at</span><span class="p">,</span> <span class="n">txt</span><span class="o">=</span><span class="n">i</span><span class="o">.</span><span class="n">txt</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">:</span> <span class="n">k</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">k</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return two <code><a href="#Num">Num</a></code>s.</p>
</div>


                            </div>
                            <div id="Num.mid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.mid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">mid</span><span class="signature">(i)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">):</span> 
    <span class="s2">&quot;Return central tendency of this distribution (using median).&quot;</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">per</span><span class="p">(</span><span class="mf">.5</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return central tendency of this distribution (using median).</p>
</div>


                            </div>
                            <div id="Num.norm" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.norm">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">norm</span><span class="signature">(i, x)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">norm</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span>
    <span class="s2">&quot;Normalize `x` to the range 0..1.&quot;</span>
    <span class="k">return</span> <span class="mi">0</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span> <span class="o">&lt;</span> <span class="mf">1E-9</span> <span class="k">else</span> <span class="p">(</span><span class="n">x</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span><span class="o">/</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="o">-</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Normalize <code>x</code> to the range 0..1.</p>
</div>


                            </div>
                            <div id="Num.per" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.per">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">per</span><span class="signature">(i, p: float = 0.5) -&gt; float</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">per</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">p</span><span class="p">:</span><span class="nb">float</span><span class="o">=</span><span class="mf">.5</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="s2">&quot;Return the p-th ranked item.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">();</span> <span class="k">return</span> <span class="n">a</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="n">p</span><span class="o">*</span><span class="nb">len</span><span class="p">(</span><span class="n">a</span><span class="p">))</span> <span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return the p-th ranked item.</p>
</div>


                            </div>
                            <div id="Num.prep" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.prep">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">prep</span><span class="signature">(i, x)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">prep</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">):</span> 
    <span class="s2">&quot;Return `x` as a float.&quot;</span>
    <span class="k">return</span> <span class="n">x</span> <span class="k">if</span> <span class="n">x</span><span class="o">==</span><span class="s2">&quot;?&quot;</span> <span class="k">else</span> <span class="nb">float</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Return <code>x</code> as a float.</p>
</div>


                            </div>
                            <div id="Num.spans" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Num.spans">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">spans</span><span class="signature">(i, j, bins, out)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">spans</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">j</span><span class="p">,</span> <span class="n">bins</span><span class="p">,</span> <span class="n">out</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Divide the whole space `lo` to `hi` into, say, `xsmall`=16 bin,</span>
<span class="sd">    then count the number of times we the bin on other side.</span>
<span class="sd">    Then merge similar adjacent bins.&quot;&quot;&quot;</span>
    <span class="n">lo</span>  <span class="o">=</span> <span class="nb">min</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">lo</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">lo</span><span class="p">)</span>
    <span class="n">hi</span>  <span class="o">=</span> <span class="nb">max</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span> <span class="n">j</span><span class="o">.</span><span class="n">hi</span><span class="p">)</span>
    <span class="n">gap</span> <span class="o">=</span> <span class="p">(</span><span class="n">hi</span><span class="o">-</span><span class="n">lo</span><span class="p">)</span> <span class="o">/</span> <span class="n">bins</span>
    <span class="n">xys</span> <span class="o">=</span> <span class="p">[(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;this&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span> <span class="o">+</span> <span class="p">[</span>
           <span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="s2">&quot;that&quot;</span><span class="p">,</span><span class="mi">1</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">j</span><span class="o">.</span><span class="n">_all</span><span class="p">]</span>
    <span class="n">one</span> <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">lo</span><span class="p">,</span><span class="n">lo</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
    <span class="k">for</span> <span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">(</span><span class="n">xys</span><span class="p">,</span> <span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">):</span>
      <span class="k">if</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span> <span class="o">-</span> <span class="n">one</span><span class="o">.</span><span class="n">lo</span> <span class="o">&gt;</span> <span class="n">gap</span><span class="p">:</span>
        <span class="n">one</span>  <span class="o">=</span> <span class="n">Span</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">one</span><span class="o">.</span><span class="n">hi</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
        <span class="nb">all</span> <span class="o">+=</span> <span class="p">[</span><span class="n">one</span><span class="p">]</span>
      <span class="n">one</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">n</span><span class="p">)</span>
    <span class="nb">all</span> <span class="o">=</span> <span class="n">merge</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span>
    <span class="nb">all</span><span class="p">[</span> <span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">lo</span> <span class="o">=</span> <span class="o">-</span><span class="n">big</span>
    <span class="nb">all</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">hi</span> <span class="o">=</span>  <span class="n">big</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="nb">all</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">1</span><span class="p">:</span> <span class="n">out</span> <span class="o">+=</span> <span class="nb">all</span>
</pre></div>

        </details>

            <div class="docstring"><p>Divide the whole space <code>lo</code> to <code>hi</code> into, say, <code>xsmall</code>=16 bin,
then count the number of times we the bin on other side.
Then merge similar adjacent bins.</p>
</div>


                            </div>
                            <div class="inherited">
                                <h5>Inherited Members</h5>
                                <dl>
                                    <div><dt><a href="#Col">Col</a></dt>
                                <dd id="Num.dist" class="function"><a href="#Col.dist">dist</a></dd>

            </div>
                                </dl>
                            </div>
                </section>
                <section id="Explain">
                                <div class="attr class">
        <a class="headerlink" href="#Explain">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Explain</span><wbr>(<span class="base"><a href="#o">o</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Explain</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Tree with `yes`,`no` branches for samples that do/do not match a `span`.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pre</span><span class="p">:</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">:</span> 
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="p">:</span>  
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>   
</pre></div>

        </details>

            <div class="docstring"><p>Tree with <code>yes</code>,<code>no</code> branches for samples that do/do not match a <code>span</code>.</p>
</div>


                            <div id="Explain.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Explain.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Explain</span><span class="signature">(here)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span><span class="p">,</span> <span class="kc">None</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Explain.show" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Explain.show">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">show</span><span class="signature">(i, pre=&#39;&#39;)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">pre</span><span class="p">:</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="s1">&#39;&#39;</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="p">:</span> 
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">True</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">yes</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="p">:</span>  
      <span class="n">s</span><span class="o">=</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">}{</span><span class="n">i</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="kc">False</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span> 
      <span class="n">tmp</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span>
      <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="n">tmp</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
      <span class="n">i</span><span class="o">.</span><span class="n">no</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>   
</pre></div>

        </details>

    

                            </div>
                </section>
                <section id="Cluster">
                                <div class="attr class">
        <a class="headerlink" href="#Cluster">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Cluster</span><wbr>(<span class="base"><a href="#o">o</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Cluster</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Tree with `left`,`right` samples, broken at median between far points.&quot;</span>
  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>

  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">left</span>  <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">  : </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span><span class="p">]:</span> 
      <span class="k">if</span> <span class="n">kid</span><span class="p">:</span> <span class="n">kid</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Tree with <code>left</code>,<code>right</code> samples, broken at median between far points.</p>
</div>


                            <div id="Cluster.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Cluster.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Cluster</span><span class="signature">(here, x=None, y=None, c=None, mid=None)</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">y</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">c</span><span class="o">=</span><span class="kc">None</span><span class="p">,</span><span class="n">mid</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">c</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">mid</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">here</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">,</span><span class="kc">None</span><span class="p">,</span><span class="kc">None</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Cluster.show" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Cluster.show">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">show</span><span class="signature">(i, pre=&#39;&#39;)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">show</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">pre</span><span class="o">=</span><span class="s2">&quot;&quot;</span><span class="p">):</span>
    <span class="n">s</span><span class="o">=</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">pre</span><span class="si">:</span><span class="s2">40</span><span class="si">}</span><span class="s2"> : </span><span class="si">{</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="si">:</span><span class="s2">5</span><span class="si">}</span><span class="s2">&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">&quot;</span> <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">left</span>  <span class="k">else</span> <span class="sa">f</span><span class="s2">&quot;</span><span class="si">{</span><span class="n">s</span><span class="si">}</span><span class="s2">  : </span><span class="si">{</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">here</span><span class="o">.</span><span class="n">y</span><span class="p">)</span><span class="si">}</span><span class="s2">&quot;</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">kid</span> <span class="ow">in</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">left</span><span class="p">,</span><span class="n">i</span><span class="o">.</span><span class="n">right</span><span class="p">]:</span> 
      <span class="k">if</span> <span class="n">kid</span><span class="p">:</span> <span class="n">kid</span><span class="o">.</span><span class="n">show</span><span class="p">(</span><span class="n">pre</span> <span class="o">+</span> <span class="s2">&quot;|.. &quot;</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                </section>
                <section id="Sample">
                                <div class="attr class">
        <a class="headerlink" href="#Sample">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Sample</span><wbr>(<span class="base"><a href="#o">o</a></span>):
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Sample</span><span class="p">(</span><span class="n">o</span><span class="p">):</span>
  <span class="s2">&quot;Load, then manage, a set of examples.&quot;</span>

  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">the</span><span class="p">,</span> <span class="n">inits</span><span class="o">=</span><span class="p">[]):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">the</span> <span class="o">=</span> <span class="n">the</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span><span class="kc">None</span>
    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">inits</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">list</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pre</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">])</span> <span class="k">if</span> <span class="n">raw</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">]</span>
    <span class="n">nump</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>
    <span class="n">skipp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;:&quot;</span>
    <span class="n">klassp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="n">goalp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">klassp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1">#---------------</span>
    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">):</span> 
      <span class="n">now</span>  <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Max</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">nump</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span>
      <span class="n">where</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">goalp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">skipp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">+=</span> <span class="p">[</span><span class="n">now</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">klassp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">now</span>
      <span class="k">return</span> <span class="n">now</span>
    <span class="c1">#----------- </span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pre</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">col</span><span class="p">))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>      <span class="n">i</span><span class="o">.</span><span class="n">cols</span>  <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span> <span class="k">for</span> <span class="n">at</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">inits</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
    <span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span> 

  <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span><span class="p">):</span>
      <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
        <span class="n">here</span>       <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">left</span>  <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">])</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span> <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">far</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">rows</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">far</span><span class="p">)</span> <span class="p">]</span>

  <span class="k">def</span> <span class="nf">half</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Using two faraway points `x,y` break data at median distance.&quot;</span>
    <span class="n">some</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span><span class="p">)</span>
    <span class="n">top</span><span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">w</span>  <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">some</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">x</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">top</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">r</span><span class="p">)</span> 
                               <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)]</span>
    <span class="n">mid</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="n">mid</span><span class="p">]),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">:]),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>

  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">mid</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>

  <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="s2">&quot;Find the distance of a `row` on a line between `x` and `y`.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> 

  <span class="k">def</span> <span class="nf">xplain</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Explain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">tiny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tiny</span><span class="p">:</span>
      <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="p">[</span><span class="n">lcol</span><span class="o">.</span><span class="n">spans</span><span class="p">(</span><span class="n">rcol</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">xsmall</span><span class="p">,</span><span class="n">spans</span><span class="p">)</span> <span class="k">for</span> <span class="n">lcol</span><span class="p">,</span><span class="n">rcol</span>
                                            <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">here</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">spans</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yes</span><span class="p">,</span> <span class="n">no</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="p">[(</span><span class="n">yes</span> <span class="k">if</span> <span class="n">here</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">selects</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">else</span> <span class="n">no</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yes</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">yes</span> <span class="o">=</span> <span class="n">yes</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">no</span><span class="o">.</span><span class="n">rows</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">no</span>  <span class="o">=</span> <span class="n">no</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>
</pre></div>

        </details>

            <div class="docstring"><p>Load, then manage, a set of examples.</p>
</div>


                            <div id="Sample.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Sample</span><span class="signature">(the, inits=[])</span>
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">the</span><span class="p">,</span> <span class="n">inits</span><span class="o">=</span><span class="p">[]):</span> 
    <span class="n">i</span><span class="o">.</span><span class="n">the</span> <span class="o">=</span> <span class="n">the</span>
    <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span><span class="p">,</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span> <span class="p">[],</span><span class="kc">None</span>
    <span class="k">if</span> <span class="nb">str</span> <span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">,</span> <span class="kc">True</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">inits</span><span class="p">)]</span>
    <span class="k">if</span> <span class="nb">list</span><span class="o">==</span><span class="nb">type</span><span class="p">(</span><span class="n">inits</span><span class="p">):</span> <span class="p">[</span><span class="n">i</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.add" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.add">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">add</span><span class="signature">(i, a, raw=False)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">add</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">a</span><span class="p">,</span> <span class="n">raw</span><span class="o">=</span><span class="kc">False</span><span class="p">):</span>
    <span class="n">pre</span>    <span class="o">=</span> <span class="k">lambda</span> <span class="n">a</span><span class="p">,</span><span class="n">c</span><span class="p">:</span> <span class="n">c</span><span class="o">.</span><span class="n">prep</span><span class="p">(</span><span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">])</span> <span class="k">if</span> <span class="n">raw</span> <span class="k">else</span> <span class="n">a</span><span class="p">[</span><span class="n">c</span><span class="o">.</span><span class="n">at</span><span class="p">]</span>
    <span class="n">nump</span>   <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="n">isupper</span><span class="p">()</span>
    <span class="n">skipp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">==</span><span class="s2">&quot;:&quot;</span>
    <span class="n">klassp</span> <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;!&quot;</span> <span class="ow">in</span> <span class="n">x</span>
    <span class="n">goalp</span>  <span class="o">=</span> <span class="k">lambda</span> <span class="n">x</span>  <span class="p">:</span> <span class="s2">&quot;+&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="s2">&quot;-&quot;</span> <span class="ow">in</span> <span class="n">x</span> <span class="ow">or</span> <span class="n">klassp</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="c1">#---------------</span>
    <span class="k">def</span> <span class="nf">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">):</span> 
      <span class="n">now</span>  <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Max</span><span class="p">,</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span> <span class="k">if</span> <span class="n">nump</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">Sym</span><span class="p">(</span><span class="n">at</span><span class="o">=</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="o">=</span><span class="n">txt</span><span class="p">)</span>
      <span class="n">where</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">y</span> <span class="k">if</span> <span class="n">goalp</span><span class="p">(</span><span class="n">txt</span><span class="p">)</span> <span class="k">else</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span>
      <span class="k">if</span> <span class="ow">not</span> <span class="n">skipp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span>
        <span class="n">where</span> <span class="o">+=</span> <span class="p">[</span><span class="n">now</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">klassp</span><span class="p">(</span><span class="n">txt</span><span class="p">):</span> <span class="n">i</span><span class="o">.</span><span class="n">klass</span> <span class="o">=</span> <span class="n">now</span>
      <span class="k">return</span> <span class="n">now</span>
    <span class="c1">#----------- </span>
    <span class="k">if</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">:</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="o">+=</span> <span class="p">[[</span><span class="n">col</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">pre</span><span class="p">(</span><span class="n">a</span><span class="p">,</span><span class="n">col</span><span class="p">))</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">]]</span>
    <span class="k">else</span><span class="p">:</span>      <span class="n">i</span><span class="o">.</span><span class="n">cols</span>  <span class="o">=</span> <span class="p">[</span><span class="n">col</span><span class="p">(</span><span class="n">at</span><span class="p">,</span><span class="n">txt</span><span class="p">)</span> <span class="k">for</span> <span class="n">at</span><span class="p">,</span><span class="n">txt</span> <span class="ow">in</span> <span class="nb">enumerate</span><span class="p">(</span><span class="n">a</span><span class="p">)]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.clone" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.clone">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">clone</span><span class="signature">(i, inits=[])</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">clone</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">inits</span><span class="o">=</span><span class="p">[]):</span>
    <span class="n">out</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="p">)</span>
    <span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">([</span><span class="n">col</span><span class="o">.</span><span class="n">txt</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">cols</span><span class="p">])</span>
    <span class="p">[</span><span class="n">out</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span> <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="n">inits</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">out</span> 
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.cluster" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.cluster">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">cluster</span><span class="signature">(i, top=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span><span class="p">):</span>
      <span class="n">left</span><span class="p">,</span><span class="n">right</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span>
        <span class="n">here</span>       <span class="o">=</span> <span class="n">Cluster</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">,</span><span class="n">mid</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">left</span>  <span class="o">=</span> <span class="n">left</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
        <span class="n">here</span><span class="o">.</span><span class="n">right</span> <span class="o">=</span> <span class="n">right</span><span class="o">.</span><span class="n">cluster</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>
</pre></div>

        </details>

            <div class="docstring"><p>Split the data using random projections. Find the span that most 
separates the data. Divide data on that span.</p>
</div>


                            </div>
                            <div id="Sample.dist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.dist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dist</span><span class="signature">(i, x, y)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">dist</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">):</span>
    <span class="n">d</span> <span class="o">=</span> <span class="nb">sum</span><span class="p">(</span> <span class="n">col</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">],</span> <span class="n">y</span><span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">at</span><span class="p">])</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">x</span> <span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">d</span><span class="o">/</span><span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">x</span><span class="p">))</span> <span class="o">**</span> <span class="p">(</span><span class="mi">1</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">p</span><span class="p">)</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.div" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.div">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">div</span><span class="signature">(i, cols=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">div</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.far" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.far">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">far</span><span class="signature">(i, x, rows=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">far</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">x</span><span class="p">,</span> <span class="n">rows</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">),</span><span class="n">y</span><span class="p">)</span> <span class="k">for</span> <span class="n">y</span> <span class="ow">in</span> <span class="p">(</span><span class="n">rows</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">tmp</span><span class="p">[</span> <span class="nb">int</span><span class="p">(</span><span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">*</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">far</span><span class="p">)</span> <span class="p">]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.half" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.half">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">half</span><span class="signature">(i, top=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">half</span><span class="p">(</span><span class="n">i</span><span class="p">,</span> <span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="s2">&quot;Using two faraway points `x,y` break data at median distance.&quot;</span>
    <span class="n">some</span><span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span> <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">&lt;</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span> <span class="k">else</span> <span class="n">random</span><span class="o">.</span><span class="n">choices</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">,</span> <span class="n">k</span><span class="o">=</span><span class="n">the</span><span class="o">.</span><span class="n">Some</span><span class="p">)</span>
    <span class="n">top</span><span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">w</span>  <span class="o">=</span> <span class="nb">any</span><span class="p">(</span><span class="n">some</span><span class="p">)</span>
    <span class="n">_</span><span class="p">,</span><span class="n">x</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">w</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">c</span><span class="p">,</span><span class="n">y</span><span class="o">=</span> <span class="n">top</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="n">x</span><span class="p">,</span> <span class="n">some</span><span class="p">)</span>
    <span class="n">tmp</span><span class="o">=</span> <span class="p">[</span><span class="n">r</span> <span class="k">for</span> <span class="n">_</span><span class="p">,</span><span class="n">r</span> <span class="ow">in</span> <span class="nb">sorted</span><span class="p">([(</span><span class="n">top</span><span class="o">.</span><span class="n">proj</span><span class="p">(</span><span class="n">r</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">),</span><span class="n">r</span><span class="p">)</span> 
                               <span class="k">for</span> <span class="n">r</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">],</span><span class="n">key</span><span class="o">=</span><span class="n">first</span><span class="p">)]</span>
    <span class="n">mid</span><span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">tmp</span><span class="p">)</span><span class="o">//</span><span class="mi">2</span>
    <span class="k">return</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[:</span><span class="n">mid</span><span class="p">]),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">:]),</span> <span class="n">x</span><span class="p">,</span> <span class="n">y</span><span class="p">,</span> <span class="n">c</span><span class="p">,</span> <span class="n">tmp</span><span class="p">[</span><span class="n">mid</span><span class="p">]</span>
</pre></div>

        </details>

            <div class="docstring"><p>Using two faraway points <code>x,y</code> break data at median distance.</p>
</div>


                            </div>
                            <div id="Sample.mid" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.mid">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">mid</span><span class="signature">(i, cols=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">mid</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">cols</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span> 
    <span class="k">return</span> <span class="p">[</span><span class="n">col</span><span class="o">.</span><span class="n">mid</span><span class="p">()</span> <span class="k">for</span> <span class="n">col</span> <span class="ow">in</span> <span class="p">(</span><span class="n">cols</span> <span class="ow">or</span> <span class="n">i</span><span class="o">.</span><span class="n">all</span><span class="p">)]</span>
</pre></div>

        </details>

    

                            </div>
                            <div id="Sample.proj" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.proj">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">proj</span><span class="signature">(i, row, x, y, c)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">proj</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">,</span><span class="n">y</span><span class="p">,</span><span class="n">c</span><span class="p">):</span>
    <span class="s2">&quot;Find the distance of a `row` on a line between `x` and `y`.&quot;</span>
    <span class="n">a</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">x</span><span class="p">)</span>
    <span class="n">b</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">row</span><span class="p">,</span><span class="n">y</span><span class="p">)</span>
    <span class="k">return</span> <span class="p">(</span><span class="n">a</span><span class="o">**</span><span class="mi">2</span> <span class="o">+</span> <span class="n">c</span><span class="o">**</span><span class="mi">2</span> <span class="o">-</span> <span class="n">b</span><span class="o">**</span><span class="mi">2</span><span class="p">)</span> <span class="o">/</span> <span class="p">(</span><span class="mi">2</span><span class="o">*</span><span class="n">c</span><span class="p">)</span> 
</pre></div>

        </details>

            <div class="docstring"><p>Find the distance of a <code>row</code> on a line between <code>x</code> and <code>y</code>.</p>
</div>


                            </div>
                            <div id="Sample.xplain" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Sample.xplain">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">xplain</span><span class="signature">(i, top=None)</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">xplain</span><span class="p">(</span><span class="n">i</span><span class="p">,</span><span class="n">top</span><span class="o">=</span><span class="kc">None</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;Split the data using random projections. Find the span that most </span>
<span class="sd">    separates the data. Divide data on that span.&quot;&quot;&quot;</span>
    <span class="n">here</span> <span class="o">=</span> <span class="n">Explain</span><span class="p">(</span><span class="n">i</span><span class="p">)</span>
    <span class="n">top</span> <span class="o">=</span> <span class="n">top</span> <span class="ow">or</span> <span class="n">i</span>
    <span class="n">tiny</span> <span class="o">=</span> <span class="nb">len</span><span class="p">(</span><span class="n">top</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span><span class="o">**</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">enough</span>
    <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&gt;=</span> <span class="mi">2</span><span class="o">*</span><span class="n">tiny</span><span class="p">:</span>
      <span class="n">left</span><span class="p">,</span> <span class="n">right</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">half</span><span class="p">(</span><span class="n">top</span><span class="p">)</span>
      <span class="n">spans</span> <span class="o">=</span> <span class="p">[]</span>
      <span class="p">[</span><span class="n">lcol</span><span class="o">.</span><span class="n">spans</span><span class="p">(</span><span class="n">rcol</span><span class="p">,</span><span class="mi">6</span><span class="o">/</span><span class="n">i</span><span class="o">.</span><span class="n">the</span><span class="o">.</span><span class="n">xsmall</span><span class="p">,</span><span class="n">spans</span><span class="p">)</span> <span class="k">for</span> <span class="n">lcol</span><span class="p">,</span><span class="n">rcol</span>
                                            <span class="ow">in</span> <span class="nb">zip</span><span class="p">(</span><span class="n">left</span><span class="o">.</span><span class="n">x</span><span class="p">,</span> <span class="n">right</span><span class="o">.</span><span class="n">x</span><span class="p">)]</span>
      <span class="k">if</span> <span class="nb">len</span><span class="p">(</span><span class="n">spans</span><span class="p">)</span> <span class="o">&gt;</span> <span class="mi">0</span><span class="p">:</span>
        <span class="n">here</span><span class="o">.</span><span class="n">span</span> <span class="o">=</span> <span class="n">Span</span><span class="o">.</span><span class="n">sort</span><span class="p">(</span><span class="n">spans</span><span class="p">)[</span><span class="mi">0</span><span class="p">]</span>
        <span class="n">yes</span><span class="p">,</span> <span class="n">no</span> <span class="o">=</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">(),</span> <span class="n">i</span><span class="o">.</span><span class="n">clone</span><span class="p">()</span>
        <span class="p">[(</span><span class="n">yes</span> <span class="k">if</span> <span class="n">here</span><span class="o">.</span><span class="n">span</span><span class="o">.</span><span class="n">selects</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">else</span> <span class="n">no</span><span class="p">)</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">row</span><span class="p">)</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">]</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">yes</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">yes</span> <span class="o">=</span> <span class="n">yes</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
        <span class="k">if</span> <span class="n">tiny</span> <span class="o">&lt;=</span> <span class="nb">len</span><span class="p">(</span><span class="n">no</span><span class="o">.</span><span class="n">rows</span> <span class="p">)</span> <span class="o">&lt;</span> <span class="nb">len</span><span class="p">(</span><span class="n">i</span><span class="o">.</span><span class="n">rows</span><span class="p">):</span> <span class="n">here</span><span class="o">.</span><span class="n">no</span>  <span class="o">=</span> <span class="n">no</span><span class="o">.</span><span class="n">xplain</span><span class="p">(</span><span class="n">top</span><span class="o">=</span><span class="n">top</span><span class="p">)</span>
    <span class="k">return</span> <span class="n">here</span>
</pre></div>

        </details>

            <div class="docstring"><p>Split the data using random projections. Find the span that most 
separates the data. Divide data on that span.</p>
</div>


                            </div>
                </section>
                <section id="Demos">
                                <div class="attr class">
        <a class="headerlink" href="#Demos">#&nbsp;&nbsp</a>

        
        <span class="def">class</span>
        <span class="name">Demos</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span><span class="k">class</span> <span class="nc">Demos</span><span class="p">:</span>
  <span class="s2">&quot;Possible start-up actions.&quot;</span>
  <span class="n">fails</span><span class="o">=</span><span class="mi">0</span>
  <span class="k">def</span> <span class="nf">opt</span><span class="p">():</span> 
    <span class="s2">&quot;show the config.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">seed</span><span class="p">():</span>
    <span class="s2">&quot;seed&quot;</span>
    <span class="k">assert</span> <span class="mf">.494</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.495</span> 

  <span class="k">def</span> <span class="nf">num</span><span class="p">():</span> 
    <span class="s2">&quot;check `Num`.&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span> <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">())</span>
    <span class="k">assert</span> <span class="mf">.30</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.31</span><span class="p">,</span> <span class="s2">&quot;in range&quot;</span>

  <span class="k">def</span> <span class="nf">sym</span><span class="p">():</span> 
    <span class="s2">&quot;check `Sym`.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">&quot;aaaabbc&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">1.37</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.38</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;a&#39;</span>  <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">mid</span><span class="p">(),</span> <span class="s2">&quot;mode&quot;</span>

  <span class="k">def</span> <span class="nf">rows</span><span class="p">():</span> 
    <span class="s2">&quot;count rows in a file.&quot;</span>
    <span class="k">assert</span> <span class="mi">399</span> <span class="o">==</span> <span class="nb">len</span><span class="p">([</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)])</span>

  <span class="k">def</span> <span class="nf">sample</span><span class="p">():</span> 
    <span class="s2">&quot;sampling.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
    <span class="k">assert</span> <span class="mi">398</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span>    <span class="s2">&quot;length of rows&quot;</span>
    <span class="k">assert</span> <span class="mi">249</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="s2">&quot;symbol counts&quot;</span>

  <span class="k">def</span> <span class="nf">dist</span><span class="p">():</span> 
    <span class="s2">&quot;distance between rows&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">.84</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">.842</span>

  <span class="k">def</span> <span class="nf">far</span><span class="p">():</span>
    <span class="s2">&quot;distant items&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
      <span class="n">a</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
      <span class="k">assert</span> <span class="n">a</span><span class="o">&gt;</span><span class="mf">.5</span><span class="p">,</span> <span class="s2">&quot;large?&quot;</span>

  <span class="k">def</span> <span class="nf">clone</span><span class="p">():</span>
    <span class="s2">&quot;cloning&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">d1</span><span class="p">,</span><span class="n">d2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
      <span class="k">assert</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;clone test&quot;</span>

  <span class="k">def</span> <span class="nf">half</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>

  <span class="k">def</span> <span class="nf">cluster</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>

  <span class="k">def</span> <span class="nf">xplain</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">xplain</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>Possible start-up actions.</p>
</div>


                            <div id="Demos.__init__" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.__init__">#&nbsp;&nbsp</a>

        
            <span class="name">Demos</span><span class="signature">()</span>
    </div>

        
    

                            </div>
                            <div id="Demos.fails" class="classattr">
                                            <div class="attr variable"><a class="headerlink" href="#Demos.fails">#&nbsp;&nbsp</a>

        <span class="name">fails</span><span class="default_value"> = 0</span>
    </div>

    

                            </div>
                            <div id="Demos.opt" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.opt">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">opt</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">opt</span><span class="p">():</span> 
    <span class="s2">&quot;show the config.&quot;</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>show the config.</p>
</div>


                            </div>
                            <div id="Demos.seed" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.seed">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">seed</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">seed</span><span class="p">():</span>
    <span class="s2">&quot;seed&quot;</span>
    <span class="k">assert</span> <span class="mf">.494</span> <span class="o">&lt;=</span> <span class="n">r</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.495</span> 
</pre></div>

        </details>

            <div class="docstring"><p>seed</p>
</div>


                            </div>
                            <div id="Demos.num" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.num">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">num</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">num</span><span class="p">():</span> 
    <span class="s2">&quot;check `Num`.&quot;</span>
    <span class="n">n</span> <span class="o">=</span> <span class="n">Num</span><span class="p">(</span><span class="mi">512</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">100</span><span class="p">):</span> <span class="n">n</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">r</span><span class="p">())</span>
    <span class="k">assert</span> <span class="mf">.30</span> <span class="o">&lt;=</span> <span class="n">n</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">.31</span><span class="p">,</span> <span class="s2">&quot;in range&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>check <code><a href="#Num">Num</a></code>.</p>
</div>


                            </div>
                            <div id="Demos.sym" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.sym">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">sym</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">sym</span><span class="p">():</span> 
    <span class="s2">&quot;check `Sym`.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sym</span><span class="p">()</span>
    <span class="k">for</span> <span class="n">x</span> <span class="ow">in</span> <span class="s2">&quot;aaaabbc&quot;</span><span class="p">:</span> <span class="n">s</span><span class="o">.</span><span class="n">add</span><span class="p">(</span><span class="n">x</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">1.37</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">div</span><span class="p">()</span> <span class="o">&lt;=</span> <span class="mf">1.38</span><span class="p">,</span> <span class="s2">&quot;entropy&quot;</span>
    <span class="k">assert</span> <span class="s1">&#39;a&#39;</span>  <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">mid</span><span class="p">(),</span> <span class="s2">&quot;mode&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>check <code><a href="#Sym">Sym</a></code>.</p>
</div>


                            </div>
                            <div id="Demos.rows" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.rows">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">rows</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">rows</span><span class="p">():</span> 
    <span class="s2">&quot;count rows in a file.&quot;</span>
    <span class="k">assert</span> <span class="mi">399</span> <span class="o">==</span> <span class="nb">len</span><span class="p">([</span><span class="n">row</span> <span class="k">for</span> <span class="n">row</span> <span class="ow">in</span> <span class="n">file</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)])</span>
</pre></div>

        </details>

            <div class="docstring"><p>count rows in a file.</p>
</div>


                            </div>
                            <div id="Demos.sample" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.sample">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">sample</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">sample</span><span class="p">():</span> 
    <span class="s2">&quot;sampling.&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">,</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
    <span class="k">assert</span> <span class="mi">398</span> <span class="o">==</span> <span class="nb">len</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">),</span>    <span class="s2">&quot;length of rows&quot;</span>
    <span class="k">assert</span> <span class="mi">249</span> <span class="o">==</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">]</span><span class="o">.</span><span class="n">has</span><span class="p">[</span><span class="s1">&#39;1&#39;</span><span class="p">],</span> <span class="s2">&quot;symbol counts&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>sampling.</p>
</div>


                            </div>
                            <div id="Demos.dist" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.dist">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">dist</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">dist</span><span class="p">():</span> 
    <span class="s2">&quot;distance between rows&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">assert</span> <span class="mf">.84</span> <span class="o">&lt;=</span> <span class="n">s</span><span class="o">.</span><span class="n">dist</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="mi">1</span><span class="p">],</span> <span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">[</span><span class="o">-</span><span class="mi">1</span><span class="p">])</span> <span class="o">&lt;=</span> <span class="mf">.842</span>
</pre></div>

        </details>

            <div class="docstring"><p>distance between rows</p>
</div>


                            </div>
                            <div id="Demos.far" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.far">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">far</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">far</span><span class="p">():</span>
    <span class="s2">&quot;distant items&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="k">for</span> <span class="n">_</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="mi">32</span><span class="p">):</span>
      <span class="n">a</span><span class="p">,</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">far</span><span class="p">(</span><span class="nb">any</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">))</span>
      <span class="k">assert</span> <span class="n">a</span><span class="o">&gt;</span><span class="mf">.5</span><span class="p">,</span> <span class="s2">&quot;large?&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>distant items</p>
</div>


                            </div>
                            <div id="Demos.clone" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.clone">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">clone</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">clone</span><span class="p">():</span>
    <span class="s2">&quot;cloning&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">clone</span><span class="p">(</span><span class="n">s</span><span class="o">.</span><span class="n">rows</span><span class="p">)</span>
    <span class="n">d1</span><span class="p">,</span><span class="n">d2</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span><span class="p">,</span> <span class="n">s1</span><span class="o">.</span><span class="n">x</span><span class="p">[</span><span class="mi">0</span><span class="p">]</span><span class="o">.</span><span class="vm">__dict__</span>
    <span class="k">for</span> <span class="n">k</span><span class="p">,</span><span class="n">v</span> <span class="ow">in</span> <span class="n">d1</span><span class="o">.</span><span class="n">items</span><span class="p">():</span> 
      <span class="k">assert</span> <span class="n">d2</span><span class="p">[</span><span class="n">k</span><span class="p">]</span> <span class="o">==</span> <span class="n">v</span><span class="p">,</span> <span class="s2">&quot;clone test&quot;</span>
</pre></div>

        </details>

            <div class="docstring"><p>cloning</p>
</div>


                            </div>
                            <div id="Demos.half" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.half">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">half</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">half</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s1</span><span class="p">,</span><span class="n">s2</span><span class="p">,</span><span class="o">*</span><span class="n">_</span> <span class="o">=</span> <span class="n">s</span><span class="o">.</span><span class="n">half</span><span class="p">()</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s1</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
    <span class="nb">print</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">mid</span><span class="p">(</span><span class="n">s2</span><span class="o">.</span><span class="n">y</span><span class="p">))</span>
</pre></div>

        </details>

            <div class="docstring"><p>divide data in two</p>
</div>


                            </div>
                            <div id="Demos.cluster" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.cluster">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">cluster</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">cluster</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">cluster</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>divide data in two</p>
</div>


                            </div>
                            <div id="Demos.xplain" class="classattr">
                                        <div class="attr function"><a class="headerlink" href="#Demos.xplain">#&nbsp;&nbsp</a>

        
            <span class="def">def</span>
            <span class="name">xplain</span><span class="signature">()</span>:
    </div>

                <details>
            <summary>View Source</summary>
            <div class="codehilite"><pre><span></span>  <span class="k">def</span> <span class="nf">xplain</span><span class="p">():</span>
    <span class="s2">&quot;divide data in two&quot;</span>
    <span class="n">s</span> <span class="o">=</span> <span class="n">Sample</span><span class="p">(</span><span class="n">the</span><span class="p">,</span> <span class="n">the</span><span class="o">.</span><span class="n">data</span><span class="p">)</span>
    <span class="n">s</span><span class="o">.</span><span class="n">xplain</span><span class="p">()</span><span class="o">.</span><span class="n">show</span><span class="p">();</span> <span class="nb">print</span><span class="p">(</span><span class="s2">&quot;&quot;</span><span class="p">)</span>
</pre></div>

        </details>

            <div class="docstring"><p>divide data in two</p>
</div>


                            </div>
                </section>
                <section id="the">
                                <div class="attr variable"><a class="headerlink" href="#the">#&nbsp;&nbsp</a>

        <span class="name">the</span><span class="default_value"> = o{:Max 512 :Some 512 :cautious False :data data/auto93.csv :enough 0.5 :far 0.9 :help False :p 2 :seed 10019 :todo nothing :xsmall 0.35?</span>
    </div>

    

                </section>
    </main>
</body>
</html>